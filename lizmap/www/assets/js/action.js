(()=>{var e=null;function a(e,a){var t=null;for(var n in actionConfig[e]){var i=actionConfig[e][n];i.name==a&&(t=i)}return t}function t(t,n,i,r){let o='<button class="btn btn-mini popup-action" value="';var l=t+"."+n+"."+i.name;o+=l,o+='" title="'+i.title+'">',o+='<i class="'+i.icon+'"></i>',o+="&nbsp;</button>";var p=r.next("span.popupButtonBar").find('button.popup-action[value="'+l+'"]'),s=r.next("span.popupButtonBar");0!=s.length?0==p.length?s.append(o):p.before(o):(o='<span class="popupButtonBar">'+o+"</span></br>",r.after(o)),r.find("button.btn").tooltip({placement:"bottom"}),$('div.lizmapPopupContent button.popup-action[value="'+l+'"]').click((function(){$("#lizmap-action-message").remove(),lizMap.layers.actionLayer.destroyFeatures();var t=$(this).val().split("."),n=t[0],i=t[1],r=t[2];if(e&&e==n+"."+i+"."+r)return e=null,!0;e=null;var o=a(n,r);if("confirm"in o&&""!=o.confirm.trim()){var l=o.confirm.trim();if(!confirm(l))return!1}return function(t,n,i){var r={layerId:t,featureId:n,name:i},o=a(t,i),l=actionConfigData.url;$.get(l,r,(function(e){if("errors"in e)return lizMap.addMessage(e.errors.title,"error",!0).attr("id","lizmap-action-message"),console.log(e.errors.detail),!1;var a=function(e,a,t){var n=lizMap.layers.actionLayer,i=new OpenLayers.Format.GeoJSON({externalProjection:"EPSG:4326",internalProjection:lizMap.map.getProjection()});"style"in a&&(n.styleMap.styles.default.defaultStyle=a.style);var r=i.read(t);return n.addFeatures(r),r}(0,o,e);if(a.length>0&&"attributes"in(d=a[0])&&"message"in d.attributes){$("#lizmap-action-message").remove();var i=d.attributes.message.trim();i&&lizMap.addMessage(i,"info",!0).attr("id","lizmap-action-message")}if(a.length>0&&"callbacks"in o&&o.callbacks.length>0)for(let e in o.callbacks){var r=o.callbacks[e],l=r.method,p=null;if("layerId"in r){var s=r.layerId,c=lizMap.getLayerConfigById(s);if(c){var u=c[1],f=c[0],m=lizMap.map.getLayersByName(u.cleanname);m.length>0&&(p=m[0])}}"redraw"==l&&null!==p&&p.redraw(!0);var d=a[0];if("select"==l&&null!==p){var y=d.clone();lizMap.selectLayerFeaturesFromSelectionFeature(f,y)}"zoom"==l&&lizMap.map.zoomToExtent(a[0].geometry.getBounds())}lizMap.events.triggerEvent("actionResultReceived",{layerId:t,featureId:n,action:o,features:a})}),"json"),e=t+"."+n+"."+i}(n,i,r),!1})).hover((function(){$(this).addClass("btn-primary")}),(function(){$(this).removeClass("btn-primary")}))}lizMap.events.on({uicreated:function(){var e;e=new OpenLayers.Layer.Vector("actionLayer",{styleMap:new OpenLayers.StyleMap({graphicName:"circle",pointRadius:6,fill:!0,fillColor:"lightblue",fillOpacity:.3,stroke:!0,strokeWidth:3,strokeColor:"blue",strokeOpacity:.8})}),lizMap.map.addLayer(e),lizMap.layers.actionLayer=e},lizmappopupdisplayed:function(){$("div.lizmapPopupContent input.lizmap-popup-layer-feature-id").each((function(){var e=$(this),a=e.val(),n=a.split(".").pop(),i=a.replace("."+n,"");if(!lizMap.getLayerConfigById(i))return!0;if(!(i in actionConfig))return!0;for(var r in actionConfig[i])t(i,n,actionConfig[i][r],e)}))}})})();
//# sourceMappingURL=action.js.map