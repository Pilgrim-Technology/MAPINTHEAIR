lizMap.events.on({uicreated:function(){if(!filterConfig||filterConfig.constructor===Object&&0===Object.keys(filterConfig).length)return $("#mapmenu li.filter.nav-dock").addClass("hide"),!0;function e(e){var t=lizMap.getLayerConfigById(e);if(!t)return!1;var l=t[0];filterConfigData.layerName=l,$("div.liz-filter-field-box").remove(),function(){var e=filterConfigData.layerId,t=[];for(var l in filterConfig)"title"in(r=filterConfig[l])&&r.layerId==e&&(t.push(r),$("#filter div.tree").append('<div id="filter-field-order'+String(r.order)+'"></div>'));for(var a in t){var r;i(r=t[a])}}(),lizMap.events.on({dockopened:function(e){"filter"==e.id&&lizMap.updateContentSize()},rightdockclosed:function(){},minidockclosed:function(){},layerfeatureremovefilter:function(){var e=filterConfigData.layerId;for(var i in filterConfigData.deactivated=!0,filterConfig){var t=filterConfig[i];"title"in t&&t.layerId===e&&f(t.order)}filterConfigData.deactivated=!1,c()}}),c(),$("#liz-filter-zoom").is(":visible")&&m()}function i(e){var i=filterConfig[e.order];return"uniquevalues"==i.type?function(e){var i={request:"getUniqueValues",layerId:e.layerId,fieldname:e.field,filter:""};$.get(filterConfigData.url,i,(function(i){if(!l(i))return!1;var a="";for(var r in a+=t(e),"select"==e.format&&(a+='<select id="liz-filter-field-'+lizMap.cleanName(e.title)+'" class="liz-filter-field-select">',a+='<option value=""> --- </option>',a+="</select>"),a+="</p></div>",$("#filter-field-order"+String(e.order)).append(a),"items"in filterConfig[e.order]||(filterConfig[e.order].items={}),i){var n=i[r];filterConfig[e.order].items[n.v]=n.c}var f="",o=Object.keys(filterConfig[e.order].items);for(var c in o.sort((function(e,i){return e.localeCompare(i)})),o){var m=o[c],u=m;"select"==e.format?f+='<option value="'+lizMap.cleanName(m)+'">':(f+='<span style="font-weight:normal;">',f+='<button id="liz-filter-field-'+lizMap.cleanName(e.title)+"-"+lizMap.cleanName(m)+'" class="btn checkbox liz-filter-field-value" value="'+lizMap.cleanName(m)+'"></button>'),f+="&nbsp;"+u,"select"==e.format?f+="</option>":f+="</span></br>"}var s="liz-filter-box-"+lizMap.cleanName(e.title);"select"==e.format?$("#"+s+" select").append(f):$("#"+s+" p").append(f),d(e)}),"json")}(e):"date"==i.type?function(e){const i="max_date"in e?e.max_date:e.min_date;var a={request:"getMinAndMaxValues",layerId:e.layerId,fieldname:e.min_date+","+i,filter:""};$.get(filterConfigData.url,a,(function(i){if(!l(i))return!1;for(var a in i){var r=i[a];"+"===r.min[r.min.length-3]&&(r.min=r.min+":00"),"+"===r.max[r.max.length-3]&&(r.max=r.max+":00");var n=o(new Date(r.min),"yy-mm-dd"),f=o(new Date(r.max),"yy-mm-dd");filterConfig[e.order].min=n,filterConfig[e.order].max=f}var c="";c+=t(e),c+='<span style="white-space:nowrap">',c+='<input id="liz-filter-field-min-date'+lizMap.cleanName(e.title)+'" class="liz-filter-field-date" value="'+e.min+'" style="width:100px;">',c+='<input id="liz-filter-field-max-date'+lizMap.cleanName(e.title)+'" class="liz-filter-field-date" value="'+e.max+'" style="width:100px;">',c+="</span>",c+='<div id="liz-filter-datetime-range'+lizMap.cleanName(e.title)+'">',c+="    <div>",c+='        <div id="liz-filter-slider-range'+lizMap.cleanName(e.title)+'"></div>',c+="    </div>",c+="</div>",c+="</p></div>",$("#filter-field-order"+String(e.order)).append(c),$("#filter input.liz-filter-field-date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,minDate:new Date(r.min),maxDate:new Date(r.max)}),d(e)}),"json")}(e):"numeric"==i.type?function(e){var i={request:"getMinAndMaxValues",layerId:e.layerId,fieldname:e.field,filter:""};$.get(filterConfigData.url,i,(function(i){if(!l(i))return!1;for(var a in i){var r=i[a];filterConfig[e.order].min=Number(r.min),filterConfig[e.order].max=Number(r.max)}var n="";n+=t(e),n+='<span style="white-space:nowrap">',n+='<input id="liz-filter-field-min-numeric'+lizMap.cleanName(e.title)+'" type="number" value="'+e.min+'" step="1" min="'+e.min+'" max="'+e.max+'" class="liz-filter-field-numeric" style="width:100px;">',n+='<input id="liz-filter-field-max-numeric'+lizMap.cleanName(e.title)+'" type="number" value="'+e.max+'" step="'+e.step+'" min="'+e.min+'" max="'+e.max+'" class="liz-filter-field-numeric" style="width:100px;">',n+="</span>",n+='<div id="liz-filter-numeric-range'+lizMap.cleanName(e.title)+'">',n+="    <div>",n+='        <div id="liz-filter-slider-range'+lizMap.cleanName(e.title)+'"></div>',n+="    </div>",n+="</div>",n+="</p></div>",$("#filter-field-order"+String(e.order)).append(n),d(e)}),"json")}(e):"text"==i.type?function(e){var i=e.field,a={request:"getUniqueValues",layerId:e.layerId,fieldname:i,filter:""};$.get(filterConfigData.url,a,(function(i){if(!l(i))return!1;var a=[];for(var r in i){var n=i[r];null===n.v||!n.v||"string"==typeof n.v&&""===n.v.trim()||a.push(n.v)}var f="";f+=t(e),f+='<div style="width: 100%;">',f+='<input id="liz-filter-field-text'+lizMap.cleanName(e.title)+'" class="liz-filter-field-text" value="" title="'+lizDict["filter.input.text.title"]+'" placeholder="'+lizDict["filter.input.text.placeholder"]+'">',f+="</div>",f+="</p></div>",$("#filter-field-order"+String(e.order)).append(f),d(e),$("#liz-filter-field-text"+lizMap.cleanName(e.title)).autocomplete({source:a,autoFocus:!1,delay:200,minLength:2,select:function(e,i){$(this).val(i.item.value),$(this).change()}})}),"json")}(e):""}function t(e){var i="";return i+='<div class="liz-filter-field-box" id="liz-filter-box-',i+=lizMap.cleanName(e.title),i+='">',i+='<span style="font-weight:bold;">'+e.title+"</span>",(i+='<button class="btn btn-primary btn-mini pull-right liz-filter-reset-field" title="'+lizDict["filter.btn.reset.title"]+'" value="'+e.order+'">x</button>')+"<p>"}function l(e){return!(!e||"status"in e&&"error"==e.status&&(console.log(e.title+": "+e.detail),1))}function a(e){if(filterConfigData.deactivated)return!1;"uniquevalues"==e.type&&function(e){var i=filterConfig[e.order];filterConfig[e.order].data={};var t=!0,l=!0;if("select"==i.format){var a="#liz-filter-field-"+lizMap.cleanName(e.title),r=$(a).val(),n=[];for(var f in filterConfig[e.order].items){if(Array.isArray(r))var o=r.includes(lizMap.cleanName(f));else o=r==lizMap.cleanName(f);o?(l=!1,n.push(f.replace(/'/g,"''"))):t=!1,filterConfig[e.order].data[f]=o}}if("checkboxes"==i.format)for(var f in n=[],filterConfig[e.order].items){var d="#liz-filter-field-"+lizMap.cleanName(e.title)+"-"+lizMap.cleanName(f);(o=$(d).hasClass("checked"))?(l=!1,n.push(f.replace(/'/g,"''"))):t=!1,filterConfig[e.order].data[f]=o}filterConfig[e.order].allchecked=t,filterConfig[e.order].nonechecked=l,filterConfig[e.order].selected=n;var c=null,m=e.field;if(n.length)if("splitter"in e&&""!=e.splitter){c=" ( ";var u="",s="LIKE";for(var p in"postgres"==e.provider&&(s="ILIKE"),n)c+=u+'"'+m+'" '+s+" '%"+n[p]+"%' ",u=" OR ";c+=" ) "}else c='"'+m+"\" IN ( '"+n.join("' , '")+"' ) ";filterConfig[e.order].filter=c}(e),"date"==e.type&&function(e){var i=[],t="#liz-filter-field-min-date"+lizMap.cleanName(e.title),l="#liz-filter-field-max-date"+lizMap.cleanName(e.title),a=$(t).val().trim(),r=$(l).val().trim();if(a==e.min&&r==e.max)return filterConfig[e.order].filter=null,!0;var n=e.min_date,f="max_date"in e?e.max_date:e.min_date;a&&Date.parse(a)?i.push('( "'+n+"\" >= '"+a+"' OR  \""+f+"\" >= '"+a+"' )"):a=null,r&&Date.parse(r)?i.push('( "'+n+"\" <= '"+r+"' OR  \""+f+"\" <= '"+r+"' )"):r=null;var o=null;i.length&&(o=" ( ",o+=i.join(" AND "),o+=" ) "),filterConfig[e.order].data={min_date:a,max_date:r},filterConfig[e.order].filter=o}(e),"numeric"==e.type&&function(e){var i=[],t="#liz-filter-field-min-numeric"+lizMap.cleanName(e.title),l="#liz-filter-field-max-numeric"+lizMap.cleanName(e.title),a=$(t).val().trim(),r=$(l).val().trim();if(a==e.min&&r==e.max)return filterConfig[e.order].filter=null,!0;var n=e.field;""!=a?i.push('( "'+n+"\" >= '"+a+"' )"):a=null,""!=r?i.push('( "'+n+"\" <= '"+r+"' )"):r=null;var f=null;i.length&&(f=" ( ",f+=i.join(" AND "),f+=" ) "),filterConfig[e.order].data={min:a,max:r},filterConfig[e.order].filter=f}(e),"text"==e.type&&function(e){var i="#liz-filter-field-text"+lizMap.cleanName(e.title),t=$(i).val().trim().replace(/'/g,"''");filterConfig[e.order].data={text:t};var l=null,a="LIKE";"postgres"==e.provider&&(a="ILIKE");var r=e.field;t&&(l='"'+r+'" '+a+" '%"+t+"%'"),filterConfig[e.order].data={text:t},filterConfig[e.order].filter=l}(e),r()}function r(){var e=filterConfigData.layerId,i=[];for(var t in filterConfig){var l=filterConfig[t];"title"in l&&l.filter&&l.layerId==e&&i.push(l.filter)}var a=i.join(" AND "),r=filterConfigData.layerName;lizMap.triggerLayerFilter(r,a),c(a),$("#liz-filter-zoom").is(":visible")&&m(a),filterConfigData.filter=a}function n(){var e=filterConfigData.layerId;for(var i in filterConfigData.deactivated=!0,filterConfig){var t=filterConfig[i];"title"in t&&t.layerId==e&&f(t.order)}filterConfigData.deactivated=!1;var l,a=filterConfigData.layerName;lizMap.deactivateMaplayerFilter(a),lizMap.events.triggerEvent("layerFilterParamChanged",{featureType:a,filter:null,updateDrawing:!1}),c(),$("#liz-filter-zoom").is(":visible")&&m(),1==(l=lizMap.map.getLayersByName("locatelayer")).length&&l[0].destroyFeatures()}function f(e){var i=filterConfig[e];if("date"==i.type)$("#liz-filter-field-min-date"+lizMap.cleanName(i.title)).val(i.min),$("#liz-filter-field-max-date"+lizMap.cleanName(i.title)).val(i.max).change();else if("numeric"==i.type)$("#liz-filter-field-min-numeric"+lizMap.cleanName(i.title)).val(i.min),$("#liz-filter-field-max-numeric"+lizMap.cleanName(i.title)).val(i.max).change();else if("uniquevalues"==i.type){if("checkboxes"==i.format)$("#liz-filter-box-"+lizMap.cleanName(i.title)+" button.liz-filter-field-value.checked").removeClass("checked");else if("select"==i.format){var t=$("#liz-filter-field-"+lizMap.cleanName(i.title));if("sumo"in t[0])t[0].hasAttribute("multiple")?t[0].sumo.unSelectAll():t[0].sumo.unSelectItem(t.val());else{var l=t.find("option:first").val();t.val(l)}}}else"text"==i.type&&$("#liz-filter-field-text"+lizMap.cleanName(i.title)).val("");filterConfig[i.order].filter=null}function o(e,i){return $.datepicker.formatDate(i,e)}function d(e){var i,t="liz-filter-box-"+lizMap.cleanName(e.title),l=filterConfig[e.order];if("uniquevalues"==e.type&&("checkboxes"==e.format&&$("#"+t+" button.liz-filter-field-value").click((function(){var i=$(this);if(i.hasClass("disabled"))return!1;i.hasClass("checked")?i.removeClass("checked"):i.addClass("checked"),a(e)})),"select"==e.format&&$("#liz-filter-field-"+lizMap.cleanName(e.title)).change((function(){a(e)}))),"date"==l.type){if(i=!0){var n=Date.parse(e.min)/1e3,d=Date.parse(e.max)/1e3,c=null;$("#liz-filter-slider-range"+lizMap.cleanName(e.title)).slider({range:!0,min:n,max:d,step:86400,values:[n,d],change:function(i,t){!function(i,t){if(filterConfigData.deactivated)return!1;clearTimeout(c),c=setTimeout((function(){var i=new Date(1e3*t.values[0]);$("#liz-filter-field-min-date"+lizMap.cleanName(e.title)).val(o(i,"yy-mm-dd"));var l=new Date(1e3*t.values[1]);$("#liz-filter-field-max-date"+lizMap.cleanName(e.title)).val(o(l,"yy-mm-dd")),a(e)}),150)}(0,t)},slide:function(i,t){var l=new Date(1e3*t.values[0]);$("#liz-filter-field-min-date"+lizMap.cleanName(e.title)).val(o(l,"yy-mm-dd"));var a=new Date(1e3*t.values[1]);$("#liz-filter-field-max-date"+lizMap.cleanName(e.title)).val(o(a,"yy-mm-dd"))}})}$("#liz-filter-field-min-date"+lizMap.cleanName(e.title)+", #liz-filter-field-max-date"+lizMap.cleanName(e.title)).change((function(){i?$("#liz-filter-slider-range"+lizMap.cleanName(e.title)).slider("values",[Date.parse($("#liz-filter-field-min-date"+lizMap.cleanName(e.title)).val())/1e3,Date.parse($("#liz-filter-field-max-date"+lizMap.cleanName(e.title)).val())/1e3]):a(e)}))}"numeric"==l.type&&((i=!0)&&(n=e.min,d=e.max,c=null,$("#liz-filter-slider-range"+lizMap.cleanName(e.title)).slider({range:!0,min:n,max:d,step:1,values:[n,d],change:function(i,t){!function(i,t){if(filterConfigData.deactivated)return!1;clearTimeout(c),c=setTimeout((function(){var i=t.values[0];$("#liz-filter-field-min-numeric"+lizMap.cleanName(e.title)).val(i);var l=t.values[1];$("#liz-filter-field-max-numeric"+lizMap.cleanName(e.title)).val(l),a(e)}),300)}(0,t)},slide:function(i,t){var l=t.values[0];$("#liz-filter-field-min-numeric"+lizMap.cleanName(e.title)).val(l);var a=t.values[1];$("#liz-filter-field-max-numeric"+lizMap.cleanName(e.title)).val(a)}})),$("#liz-filter-field-min-numeric"+lizMap.cleanName(e.title)+", #liz-filter-field-max-numeric"+lizMap.cleanName(e.title)).change((function(){i?$("#liz-filter-slider-range"+lizMap.cleanName(e.title)).slider("values",[$("#liz-filter-field-min-numeric"+lizMap.cleanName(e.title)).val(),$("#liz-filter-field-max-numeric"+lizMap.cleanName(e.title)).val()]):a(e)}))),"text"==l.type&&$("#liz-filter-field-text"+lizMap.cleanName(e.title)).change((function(){a(e)})),$("#liz-filter-box-"+lizMap.cleanName(e.title)+" button.liz-filter-reset-field").click((function(){f($(this).val()),r()})),$("#liz-filter-box-"+lizMap.cleanName(e.title)+" [title]").tooltip()}function c(e){e=void 0!==e?e:"";var i={request:"getFeatureCount",layerId:filterConfigData.layerId,filter:e};$.get(filterConfigData.url,i,(function(e){if(!e)return!1;if("status"in e&&"error"==e.status)return console.log(e.title+": "+e.detail),!1;for(var i in e){var t=e[i],l=t.c;try{l=(new Intl.NumberFormat).format(l)}catch(e){l=t.c}$("#liz-filter-item-layer-total-count").html(l)}}),"json")}function m(e){e=void 0!==e?e:"";var i=filterConfigData.layerId,t=lizMap.map.getProjection();"EPSG:900913"==t&&(t="EPSG:3857");var l=filterConfigData.layerName;if(!e){var a=lizMap.config.layers[l];if("bbox"in a){var r=a.bbox[t].bbox,n=r[0]+","+r[1]+","+r[2]+","+r[3];$("#liz-filter-zoom").val(n)}return!1}var f={request:"getExtent",layerId:i,filter:e,crs:t};$.get(filterConfigData.url,f,(function(e){if(!e)return!1;if("status"in e&&"error"==e.status)return console.log(e.title+": "+e.detail),void $("#liz-filter-zoom").hide();for(var i in e){var t=e[i].bbox;if(!t)return!1;sbbox=$.parseJSON(t),bbox=sbbox.bbox;var l=bbox[0]+","+bbox[1]+","+bbox[2]+","+bbox[3];$("#liz-filter-zoom").val(l)}}),"json")}!function(){if(!filterConfig||filterConfig.constructor===Object&&0===Object.keys(filterConfig).length)return!1;var e=function(){var e="";e+='<div class="menu-content">',e+='<select id="liz-filter-layer-selector">';var i={};for(var t in filterConfig){var l=filterConfig[t];if(!(l.layerId in i)){var a=l.layerId,r=lizMap.getLayerConfigById(a);if(!r)continue;var n=r[0],f=r[1],o=n;"title"in f&&""!=f.title&&(o=f.title),e+='<option value="'+a+'">'+o+"</option>",i[a]=!0}}return e+="</select></br>",e+='<b><span id="liz-filter-item-layer-total-count">0</span> '+lizDict["filter.label.features"]+"</b>",e+='<br/><button id="liz-filter-zoom" class="btn btn-mini btn-primary" title="'+lizDict["filter.btn.zoom.title"]+'">'+lizDict["filter.btn.zoom.label"]+"</button>",lizMap.getVectorLayerResultFormat().includes("ODS")&&(e+='&nbsp;&nbsp;<button id="liz-filter-export" class="btn btn-mini btn-primary" title="'+lizDict["filter.btn.export.title"]+'">'+lizDict["filter.btn.export.label"]+"</button>"),e+='&nbsp;&nbsp;<button id="liz-filter-unfilter" class="btn btn-mini btn-primary" title="'+lizDict["filter.btn.reset.title"]+'">'+lizDict["filter.btn.reset.label"]+"</button>",(e+="</div>")+'<div style="padding:10px 10px;" class="tree menu-content"></div>'}();$("#filter-content").html(e);var i=filterConfig[0].layerId;filterConfigData.layerId=i,$("#liz-filter-unfilter").click((function(){return n(),!1})),$("#liz-filter-zoom").click((function(){return function(){var e=$("#liz-filter-zoom").val(),i=null;if(e&&(i=e.split(",")),!e||4!=i.length)return!1;var t=new OpenLayers.Bounds(i[0],i[1],i[2],i[3]);lizMap.map.zoomToExtent(t)}(),!1})),lizMap.getVectorLayerResultFormat().includes("ODS")&&$("#liz-filter-export").click((function(){return lizMap.config.layers[filterConfigData.layerName].request_params.filter=filterConfigData.filter,lizMap.exportVectorLayer(filterConfigData.layerName,"ODS",!1),delete lizMap.config.layers[filterConfigData.layerName].request_params.filter,!1})),$("#filter-content [title]").tooltip()}(),e(filterConfigData.layerId),$("#liz-filter-layer-selector").change((function(){n(),filterConfigData.layerId=$(this).val(),e($(this).val())}))}});
//# sourceMappingURL=filter.js.map