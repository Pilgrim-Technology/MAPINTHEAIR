/*! For license information please see map.js.LICENSE.txt */
window.lizMap=function(){var e=null,t=null,a=null,n=null,i=null,o=[],r=[],l={},s={scales:[],layouts:[]},p={config:{type:"group"}},m={FI_POINT_TOLERANCE:25,FI_LINE_TOLERANCE:10,FI_POLYGON_TOLERANCE:5},u={osm:"osm-mapnik","osm-toner":"osm-stamen-toner","osm-cycle":"osm-cyclemap",gsat:"google-satellite",ghyb:"google-hybrid",gphy:"google-terrain",gmap:"google-street",bmap:"bing-road",baerial:"bing-aerial",bhybrid:"bing-hybrid",ignmap:"ign-scan",ignplan:"ign-plan",ignphoto:"ign-photo",igncadastral:"ign-cadastral"},c={"osm-mapnik":"osm","osm-stamen-toner":"osm-toner","osm-cyclemap":"osm-cycle","google-satellite":"gsat","google-hybrid":"ghyb","google-terrain":"gphy","google-street":"gmap","bing-road":"bmap","bing-aerial":"baerial","bing-hybrid":"bhybrid","ign-scan":"ignmap","ign-plan":"ignplan","ign-photo":"ignphoto","ign-cadastral":"igncadastral",empty:"emptyBaselayer"},f={},d={},y={},g={},v=null,h={};function b(e){if(e in f)return e;if(null==e)return console.log("An undefined name has been clean"),"";var t=function(e){var t={à:"a",á:"a",â:"a",ã:"a",ä:"a",ç:"c",è:"e",é:"e",ê:"e",ë:"e",ì:"i",í:"i",î:"i",ï:"i",ñ:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ù:"u",ú:"u",û:"u",ü:"u",ý:"y",ÿ:"y",À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Ç:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ñ:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ý:"Y","-":" ","'":" ","(":" ",")":" "},a=function(e){for(var a="",n=0;n<e.length;n++)a+=t[e.charAt(n)]||e.charAt(n);return a}(e),n=new RegExp("\\W","g");return a.replace(n,"_")}(e);if(t in f&&f[t]!=e){for(var a=1,n=t+a;n in f&&f[n]!=e;)n=t+(a+=1);t=n}return f[t]=e,t}function L(e){var t=null;return e in h&&(t=h[e]),null==t&&e in f&&(t=f[e],h[e]=t),t}function z(){var t;(t=Q())!=$("#content").hasClass("mobile")&&(t?($("#content, #headermenu").addClass("mobile"),$("#button-switcher").parent().hasClass("active")&&$("#button-switcher").click(),$("#button-tooltip-layer").parent().hasClass("active")&&$("#button-tooltip-layer").click(),$("#menu").is(":visible")&&$("#menu").hide(),$("#map-content").append($("#toolbar")),$("#toggleLegend").attr("data-original-title",$("#toggleLegendOn").attr("value")).parent().attr("class","legend"),$("div.locate-layer select").show(),$("span.custom-combobox").hide()):($("#content, #headermenu").removeClass("mobile"),$("#button-switcher").parent().hasClass("active")||$("#button-switcher").click(),$("#menu").is(":visible")?$("#map-content").show():$("#content span.ui-icon-open-menu").click(),$("#toolbar").insertBefore($("#switcher-menu")),$("#toggleLegend").attr("data-original-title",$("#toggleMapOnlyOn").attr("value")).parent().attr("class","map"),$("div.locate-layer select").hide(),$("span.custom-combobox").show()));var a=$(window).innerHeight();a-=$("#header").height(),$("#map").height(a),$("body").css("padding-top",$("#header").outerHeight());var n=$("body").parent()[0].offsetWidth;n-=parseInt($("#map-content").css("margin-left")),n-=parseInt($("#map-content").css("margin-right")),$("#menu").is(":hidden")||$("#map-content").hasClass("fullscreen")?$("#map-content").css("margin-left","auto"):(n-=$("#menu").width(),$("#map-content").css("margin-left",$("#menu").width())),$("#map").width(n),$("#right-dock-tabs").is(":visible")&&$("#right-dock-content").css("max-height",$("#right-dock").height()-$("#right-dock-tabs").height()),i&&function(){var t=3e3,a=3e3;"wmsMaxWidth"in e.options&&e.options.wmsMaxWidth&&(t=Number(e.options.wmsMaxWidth)),"wmsMaxHeight"in e.options&&e.options.wmsMaxHeight&&(a=Number(e.options.wmsMaxHeight));var n=!1,o=i.getCurrentSize(),r=o.clone();if(o.w>t||o.h>a){n=!0;var l=Math.max(t,a),s=Math.min(t,a),p=Math.max(o.w,o.h),m=Math.min(o.w,o.h);r=p/2>m?new OpenLayers.Size(Math.round(p/2),Math.round(p/2)):l/2>m?new OpenLayers.Size(Math.round(l/2),Math.round(l/2)):new OpenLayers.Size(Math.round(s/2),Math.round(s/2))}for(var u=0,c=i.layers.length;u<c;++u){var d=i.layers[u];if(d instanceof OpenLayers.Layer.WMS){var y=null;d.name in f&&(y=L(d.name));var g=null;y&&(g=e.layers[y]),g||(g=e.layers[d.params.LAYERS]),g||(g=e.layers[d.name]),g&&"True"==g.singleTile&&(n&&d.singleTile?d.addOptions({singleTile:!1,tileSize:r}):n||d.singleTile||(r.h=parseInt(r.h*d.ratio,10),r.w=parseInt(r.w*d.ratio,10),d.addOptions({singleTile:!0,tileSize:r})))}}var v=i.getCenter();i.updateSize(),i.setCenter(v),i.baseLayer.redraw(),O()}()}function O(){if(0==$("#mini-dock .tab-pane:visible").length)return 0;var e=$("#mini-dock .tab-pane:visible h3 ~ .menu-content:first");e.css("max-height","100%");var t=$("#mini-dock").height();t-=$("#mini-dock .tab-pane:visible h3").height(),t-=parseInt(e.css("margin-top"))?parseInt(e.css("margin-top")):0,t-=parseInt(e.css("margin-bottom"))?parseInt(e.css("margin-bottom")):0,t-=parseInt(e.css("padding-top"))?parseInt(e.css("padding-top")):0,t-=parseInt(e.css("padding-bottom"))?parseInt(e.css("padding-bottom")):0,e.css("max-height",t).css("overflow-x","hidden").css("overflow-y","auto")}function S(t,a){var n=null;if($.each(r,(function(e,a){null==n&&a.name==t&&(n=a)})),null==n)return null;var o=null;t in f&&(o=L(t));var l=null;if(o&&(l=e.layers[o]),l||(l=e.layers[n.params.LAYERS]),l||(l=e.layers[n.name]),!l)return null;if("externalWmsToggle"in l&&"True"==l.externalWmsToggle&&"externalAccess"in l&&l.externalAccess&&"layers"in l.externalAccess&&"url"in l.externalAccess){var s=l.externalAccess,p={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetLegendGraphic",LAYER:s.layers,STYLE:s.styles,SLD_VERSION:"1.1.0",EXCEPTIONS:"application/vnd.ogc.se_inimage",FORMAT:"image/png",TRANSPARENT:"TRUE",WIDTH:150,DPI:96},m=OpenLayers.Util.getParameterString(p);return OpenLayers.Util.urlAppend(s.url,m)}p={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetLegendGraphic",LAYER:n.params.LAYERS,STYLE:n.params.STYLES,EXCEPTIONS:"application/vnd.ogc.se_inimage",FORMAT:"image/png",TRANSPARENT:"TRUE",WIDTH:150,LAYERFONTSIZE:9,ITEMFONTSIZE:9,SYMBOLSPACE:1,ICONLABELSPACE:2,DPI:96,RULELABEL:"AUTO"},l.id==l.name?p.LAYERFONTBOLD="TRUE":(p.LAYERFONTSIZE=0,p.LAYERSPACE=0,p.LAYERFONTBOLD="FALSE",p.LAYERTITLE="FALSE"),a&&(p.SCALE=i.getScale()),m=OpenLayers.Util.getParameterString(p);var u=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));return OpenLayers.Util.urlAppend(u,m)}function T(t,a,n){for(var i=0,o=t.nestedLayers.length;i<o;i++){var r=t.nestedLayers[i],l=r.name;"useLayerIDs"in e.options&&"True"==e.options.useLayerIDs?l=d[r.name]:r.name in y&&(l=y[r.name]);var s=e.layers[l];if(0!=r.nestedLayers.length)return T(r,a,n);s&&((null==a||s.minScale<a)&&(a=s.minScale),(null==n||s.maxScale>n)&&(n=s.maxScale))}return a<1&&(a=1),{minScale:a,maxScale:n}}function x(t){if(!("layersOrder"in e))return-1;if(0==t.nestedLayers.length){var a=t.name;return"useLayerIDs"in e.options&&"True"==e.options.useLayerIDs?a=d[t.name]:t.name in y&&(a=y[t.name]),a in e.layersOrder?e.layersOrder[t.name]:-1}for(var n=-1,i=0,o=t.nestedLayers.length;i<o;i++){var r=t.nestedLayers[i];a=r.name,"useLayerIDs"in e.options&&"True"==e.options.useLayerIDs?a=d[r.name]:r.name in y&&(a=y[r.name]);var l;-1!=(l=0!=r.nestedLayers.length?T(r):a in e.layersOrder?e.layersOrder[a]:-1)&&(-1==n||l<n)&&(n=l)}return n}function E(t,n){n.children=[];var i=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));if(lizUrls.publicUrlList&&lizUrls.publicUrlList.length>1){i=[];for(var l=0,s=lizUrls.publicUrlList.length;l<s;l++)i.push(OpenLayers.Util.urlAppend(lizUrls.publicUrlList[l],OpenLayers.Util.getParameterString(lizUrls.params)))}for(var p=new OpenLayers.Format.WMTSCapabilities({}),m=0,u=t.nestedLayers.length;m<u;m++){var c=i,f=t.nestedLayers[m],g=f.name;if("useLayerIDs"in e.options&&"True"==e.options.useLayerIDs?g=d[f.name]:f.name in y&&(g=y[f.name]),g in e.layers){var v=e.layers[g],L=b(g);if(h[L]=g,"hidden"!=g.toLowerCase())if("Overview"!=g){if(v){"True"==v.groupAsLayer&&(v.type="layer");var z=$.map(f.styles,(function(e){return e.name}));0!=z.length?v.styles=z:"qgisServerVersion"in e.options&&e.options.qgisServerVersion.startsWith("3.")?v.styles=[""]:v.styles=["default"];var O={name:L,config:v,parent:n},S="styles"in v?v.styles[0]:"default";"undefined"!=typeof lizLayerStyles&&L in lizLayerStyles&&lizLayerStyles[L]&&(S=lizLayerStyles[L]);var C={layers:f.name,styles:S,version:"1.3.0",exceptions:"application/vnd.ogc.se_inimage",format:v.imageFormat?v.imageFormat:"image/png",dpi:96};"image/jpeg"!=C.format&&(C.transparent=!0),"object"==typeof f.attribution&&("href"in f.attribution&&""!=f.attribution.href&&-1==f.attribution.href.indexOf("://")&&(f.attribution.href="http://"+f.attribution.href),"title"in f.attribution&&""!=f.attribution.title?"href"in f.attribution&&""!=f.attribution.href||(f.attribution=f.attribution.title):f.attribution.title=f.attribution.href.split("://")[1]);var k=null;"True"==v.cached&&a&&$.each(a.contents.layers,(function(t,n){if(n.identifier!=f.name)return!0;var i={layer:f.name,matrixSet:e.options.projection.ref,name:L,params:C,attribution:f.attribution,isBaseLayer:"True"==v.baseLayer,alwaysInRange:!1,url:c};if(-1!=$.inArray(e.options.projection.ref.toUpperCase(),["EPSG:3857","EPSG:900913"])&&"resolutions"in e.options&&0!=e.options.resolutions.length){for(var o=e.options.resolutions,r=o[0],l=o.length,s=0,m=156543.03390625;m>r;)s+=1,m=156543.03390625/Math.pow(2,s);i.zoomOffset=s,i.maxResolution=r,i.numZoomLevels=l,i.minZoomLevel=s,i.resolutions=o}return(k=p.createLayer(a,i)).yx={},k.reverseAxisOrder=function(){var e=this.projection.getCode();return parseFloat("1.3.0")>=1.3&&!!(this.yx[e]||OpenLayers.Projection.defaults[e]&&OpenLayers.Projection.defaults[e].yx)},!1}));var w=null;if("externalAccess"in v&&v.externalAccess&&"layers"in v.externalAccess&&"url"in v.externalAccess&&((w=v.externalAccess).layers=decodeURI(w.layers),c=w.url,C={layers:w.layers,styles:w.styles?w.styles:"",crs:w.crs?w.crs:"EPSG:3857",format:w.format?w.format:"image/png",transparent:w.transparent?w.transparent:"true",exceptions:"application/vnd.ogc.se_inimage"}),"undefined"!=typeof lizLayerFilter&&g in lizLayerFilter&&lizLayerFilter[g]&&(C.FILTER=g+":"+lizLayerFilter[g]),"True"==v.baseLayer&&null!=k)o.push(k);else if("layer"==v.type&&null!=k){if(k.options.minScale=v.maxScale,k.options.maxScale=null!=v.minScale&&v.minScale<1?1:v.minScale,0!=f.nestedLayers.length){var M=T(f,null,null);k.options.minScale=M.maxScale,k.options.maxScale=M.minScale}k.isVisible="True"==v.toggled,k.visibility=!1,k.transitionEffect=null,k.removeBackBufferDelay=250,k.order=x(f),r.push(k)}else if("True"==v.baseLayer)o.push(new OpenLayers.Layer.WMS(L,c,C,{isBaseLayer:!0,gutter:"True"==v.cached?0:5,buffer:0,singleTile:"True"==v.singleTile,ratio:1,attribution:f.attribution}));else if("layer"==v.type){var P=new OpenLayers.Layer.WMS(L,c,C,{isBaseLayer:!1,minScale:v.maxScale,maxScale:null!=v.minScale&&v.minScale<1?1:v.minScale,isVisible:"True"==v.toggled,visibility:!1,gutter:"True"==v.cached?0:5,buffer:0,transitionEffect:"True"==v.singleTile?"resize":null,removeBackBufferDelay:250,singleTile:"True"==v.singleTile||"True"==v.cached&&!a,ratio:1,order:x(f),attribution:f.attribution});0!=f.nestedLayers.length&&(M=T(f,null,null),P.minScale=M.maxScale,P.options.minScale=M.maxScale,P.maxScale=M.minScale,P.options.maxScale=M.minScale),w&&"format"in C&&"params"in P&&P.params.FORMAT!=C.format&&(P.params.FORMAT=C.format),r.push(P)}"group"==v.type&&0!=f.nestedLayers.length&&"False"==v.baseLayer&&E(f,O),"True"!=v.baseLayer&&n.children.push(O),v.bbox=f.bbox}}else e.options.hasOverview=!0}}}function C(e){var t=e.config;if("layer"==t.type&&"True"!=t.baseLayer)return!0;if("layer"==t.type)return!1;if(!("children"in e))return!1;for(var a=e.children,n=!1,i=[],o=0,r=a.length;o<r;o++){var l=C(a[o]);l||i.push(o),n=n||l}for(i.reverse(),o=0,r=i.length;o<r;o++)a.splice(i[o],1);return n}function k(t,a){var n,i="",o=t.config,r=null;a&&(r=a.config),!("geometryType"in o)||"none"!=o.geometryType&&"unknown"!=o.geometryType&&""!=o.geometryType||(o.displayInLegend="False"),i+='<tr id="'+o.type+"-"+t.name+'"',i+=' class="liz-'+o.type,a&&(i+=" child-of-group-"+a.name),"children"in t&&0!=t.children.length&&(i+=" expanded parent"),("displayInLegend"in o&&"False"==o.displayInLegend||r&&"displayInLegend"in r&&"False"==r.displayInLegend)&&(i+=" liz-hidden"),r&&"mutuallyExclusive"in r&&"True"==r.mutuallyExclusive&&(i+=" mutually-exclusive"),i+='">',i+='<td><button class="btn checkbox" name="'+o.type+'" value="'+t.name+'" title="'+lizDict["tree.button.checkbox"]+'"></button>',i+='<span class="label" title="'+(50,((n=$("<div>"+o.abstract+"</div>").text()).length>50?n.substr(0,49)+"&hellip;":n)+'">')+o.title+"</span>",i+="</td>",i+='<td class="loading">',"layer"==o.type&&(i+='<span class="loading">&nbsp;</span>'),i+="</td>";var l="";if(o.link&&(l=o.link),i+=""!=l?'<td><button class="btn link" name="link" title="'+lizDict["tree.button.link"]+'" value="'+l+'"/></td>':"<td></td>",o.cached&&"True"==o.cached&&"layer"==o.type&&"removeCache"in e.options?i+='<td><button class="btn removeCache" name="removeCache" title="'+lizDict["tree.button.removeCache"]+'" value="'+t.name+'"/></td>':i+="<td></td>",i+="</tr>","layer"==o.type&&(!o.noLegendImage||"True"!=o.noLegendImage)&&"displayInLegend"in o&&"True"==o.displayInLegend){var s=S(t.name,!1);null!=s&&""!=s&&(i+='<tr id="legend-'+t.name+'" class="child-of-layer-'+t.name+' legendGraphics">',i+='<td colspan="2"><div class="legendGraphics">',i+='<img data-src="'+s+'" src="'+lizUrls.basepath+'assets/css/images/download_layer.gif"/>',i+="</div></td>",i+="</tr>")}return i}function w(e,t){var a="";0==t&&(a+='<div class="without-blocks no-group">',a+='<table class="tree">');for(var n=e.children,i=0,o=n.length;i<o;i++){var r=n[i];a+=0==t?k(r):k(r,e),"children"in r&&0!=r.children.length&&(a+=w(r,t+1))}return 0==t&&(a+="</table>",a+="</div>"),a}function M(t){var a=e.locateByLayer[t],n={};for(var i in a.features)n[i]=a.features[i];if("filterFieldName"in a){var o=$("#locate-layer-"+b(t)+"-"+a.filterFieldName).val();if("-1"!=o)for(var i in n)(y=n[i]).properties[a.filterFieldName]!=o&&delete n[i];else n={}}if("vectorjoins"in a&&0!=a.vectorjoins.length)for(var r=a.vectorjoins,l=0,s=r.length;l<s;l++){var p=r[l],m=p.joinLayer;if(m in e.locateByLayer){var u=e.locateByLayer[m],c=$("#locate-layer-"+b(m)).val();if("-1"==c)continue;var f=u.features[c];for(var i in n)(y=n[i]).properties[p.targetFieldName]!=f.properties[p.joinFieldName]&&delete n[i]}}var d='<option value="-1"></option>';for(var i in n){var y;d+='<option value="'+(y=n[i]).id+'">'+y.properties[a.fieldName]+"</option>"}$("#locate-layer-"+b(t)).html(d)}function P(e){var t=i.getLayersByName(e);0!=t.length&&t[0].destroyFeatures()}function N(t){P("locatelayer");var a=e.locateByLayer[t],n=b(t),o=new OpenLayers.Projection(a.crs),r=$("#locate-layer-"+n).val();if("-1"==r)lizMap.events.triggerEvent("lizmaplocatefeaturecanceled",{featureType:t});else{var l=a.features[r],s=new OpenLayers.Format.GeoJSON({ignoreExtraDims:!0});if(null!=(l=s.read(l)[0]).geometry){if(l.geometry.transform(o,i.getProjection()),"True"==a.displayGeom){var p=i.getLayersByName("locatelayer")[0];if(void 0===p)return;var m=ae(t,null,null,null);m.options.PROPERTYNAME=["geometry",a.fieldName].join(","),m.options.FEATUREID=r,$.post(m.url,m.options,(function(e){e.features||(e=JSON.parse(e)),0!=e.features.length&&(l=s.read(e.features[0])[0]).geometry.transform(o,i.getProjection()),p.addFeatures([l])})).fail((function(){p.addFeatures([l])}))}i.zoomToExtent(l.geometry.getBounds())}var u=r.split(".")[1];lizMap.events.triggerEvent("lizmaplocatefeaturechanged",{featureType:t,featureId:u})}}function R(t){var a=e.locateByLayer[t],n=["geometry",a.fieldName];if("filterFieldName"in a&&n.push(a.filterFieldName),"filterjoins"in a)for(var i=a.filterjoins,o=0,r=i.length;o<r;o++){var l=i[o];n.push(l.targetFieldName)}if("vectorjoins"in a){var s=a.vectorjoins;for(o=0,r=s.length;o<r;o++){var p=s[o];n.push(p.targetFieldName)}}var m=ae(t,null,null,"extent");m.options.PROPERTYNAME=n.join(",");var u=b(t);$.post(m.url,m.options,(function(n){var i=e.layers[t];a.features={},n.features||(n=JSON.parse(n));var o=n.features;if("EPSG:4326"!=a.crs&&0!=o.length&&X(a.crs,(function(){"qgisServerVersion"in e.options&&"2.14"!=e.options.qgisServerVersion&&(a.crs="EPSG:4326")})),"filterFieldName"in a){o.sort((function(e,t){var n=e.properties[a.filterFieldName],i=t.properties[a.filterFieldName];return isNaN(n)?isNaN(i)?n.localeCompare(i):1:isNaN(i)?-1:parseFloat(n)-parseFloat(i)}));var r="";"filterFieldAlias"in a&&""!=a.filterFieldAlias?r+=a.filterFieldAlias+" ":r+=a.filterFieldName,r+=" ("+i.title+")";for(var l='<option value="-1"></option>',s="-1",p=0,m=o.length;p<m;p++)s!=(d=o[p]).properties[a.filterFieldName]&&(l+='<option value="'+(s=d.properties[a.filterFieldName])+'">'+s+"</option>");$("#locate-layer-"+u).parent().before('<div class="locate-layer"><select id="locate-layer-'+u+"-"+a.filterFieldName+'">'+l+"</select></div><br/>"),$("#locate-layer-"+u+"-"+a.filterFieldName).change((function(){var e=$(this).children(":selected").val();M(t),"-1"==e&&$("#locate-layer-"+u+"-"+a.filterFieldName+" ~ span > input").val(""),$("#locate-layer-"+u+" ~ span > input").val(""),$("#locate-layer-"+u).val("-1"),N(t)})),$("#locate-layer-"+u+"-"+a.filterFieldName).combobox({position:{my:"right top",at:"right bottom"},selected:function(e,t){if(t.item){var a=$(this),n=$(t.item);window.setTimeout((function(){a.val(n.val()).change()}),1)}}}),$("#locate-layer-"+u+"-"+a.filterFieldName+" ~ span > input").attr("placeholder",r).val(""),$("#locate-layer-"+u+"-"+a.filterFieldName+" ~ span > input").autocomplete("close"),O()}o.sort((function(e,t){var n=e.properties[a.fieldName],i=t.properties[a.fieldName];return isNaN(n)?isNaN(i)?n.localeCompare(i):1:isNaN(i)?-1:parseFloat(n)-parseFloat(i)}));var c="";"filterFieldName"in a?("fieldAlias"in a&&""!=a.fieldAlias?c+=a.fieldAlias+" ":c+=a.fieldName+" ",c+="("+i.title+")"):c=i.title;var f='<option value="-1"></option>';for(p=0,m=o.length;p<m;p++){var d=o[p];a.features[d.id.toString()]=d,"filterFieldName"in a||(f+='<option value="'+d.id+'">'+d.properties[a.fieldName]+"</option>")}$("#locate-layer-"+u).html(f).change((function(){if("-1"==$(this).children(":selected").val()){if($("#locate-layer-"+u+" ~ span > input").val(""),"filterjoins"in a&&0!=a.filterjoins.length)for(var n=0,i=(r=a.filterjoins).length;n<i;n++)if((l=r[n].joinLayer)in e.locateByLayer){var o=$("#locate-layer-"+b(l)).val();return M(l),void $("#locate-layer-"+b(l)).val(o)}if("vectorjoins"in a&&1==a.vectorjoins.length&&(l=a.vectorjoins[0].joinLayer)in e.locateByLayer)return void N(l);N(t)}else if(N(t),"filterjoins"in a&&0!=a.filterjoins.length){var r;for(n=0,i=(r=a.filterjoins).length;n<i;n++){var l;(l=r[n].joinLayer)in e.locateByLayer&&(M(l),$("#locate-layer-"+b(l)).val("-1"),$("#locate-layer-"+b(l)+" ~ span > input").val(""))}}$(this).blur()})),$("#locate-layer-"+u).combobox({minLength:"minLength"in a?a.minLength:0,position:{my:"right top",at:"right bottom"},selected:function(e,t){if(t.item){var a=$(this),n=$(t.item);window.setTimeout((function(){a.val(n.val()).change()}),1)}}}),$("#locate-layer-"+u+" ~ span > input").attr("placeholder",c).val(""),$("#locate-layer-"+u+" ~ span > input").autocomplete("close"),"minLength"in a&&a.minLength>0&&$("#locate-layer-"+u).parent().addClass("no-toggle"),Q()&&($("div.locate-layer select").show(),$("span.custom-combobox").hide())}),"json")}function j(){$("#switcher-layers").html(w(p,0)),$("#switcher table.tree").treeTable({stringExpand:lizDict["tree.button.expand"],stringCollapse:lizDict["tree.button.collapse"],onNodeShow:function(){var e=$(this);if(e.addClass("visible"),0!=e.find("div.legendGraphics").length){var t=S(e.attr("id").replace("legend-",""),!0);if(null!=t&&""!=t){var a=e.find("div.legendGraphics img");a.attr("data-src",t),a.attr("src",a.attr("data-src"))}}},onNodeHide:function(){$(this).removeClass("visible")}}),$("#switcher table.tree tbody").on("mousedown","tr td span",(function(e){if(1===e.which){var t=!$(this).parents("tr:first").hasClass("selected");$("#switcher table.tree tbody tr").removeClass("selected"),$(this).parents("tr:first").toggleClass("selected",t),$("#switcher-layers-actions").toggleClass("active",t);var a=$(this).parents("tr:first").attr("id"),n=a.split("-")[0],i=a.split("-")[1];lizMap.events.triggerEvent("lizmapswitcheritemselected",{name:i,type:n,selected:t})}}));var t="child-of-";function a(e){return $(e).siblings("tr.child-of-"+e[0].id)}function n(e){var t=[],i=[];e&&e[0]&&(i=a(e));for(var o=0,r=i.length;o<r;o++)t.push(i[o]),t=t.concat(n([i[o]]));return t}function l(e){if(0==e.length)return null;for(var a=e[0].className.split(" "),n=0;n<a.length;n++)if(a[n].match(t))return $(e).siblings("#"+a[n].substring(t.length));return null}function s(e){for(var t=[];e=l(e);)t[t.length]=e[0];return t}$("#switcher button.checkbox").click((function(){var e=$(this);if(e.hasClass("disabled"))return!1;var t=e.parents("tr").first(),o=l(t),r=[];if(o&&0!=o.length)for(var p=0,m=a(o);p<m.length;p++)(d=$(m[p])).attr("id")!=t.attr("id")&&r.push(d);var u=[];if(t.hasClass("liz-layer"))if(e.hasClass("checked")?(e.removeClass("partial").removeClass("checked"),t.find('button.checkbox[name="layer"]').each((function(e,t){var a=$(t).val(),n=i.getLayersByName(a)[0];void 0!==n&&n.setVisibility(!1)}))):(e.removeClass("partial").addClass("checked"),t.find('button.checkbox[name="layer"]').each((function(e,t){var a=$(t).val(),n=i.getLayersByName(a)[0];void 0!==n&&n.setVisibility(!0)}))),t.hasClass("mutually-exclusive")){if(e.hasClass("checked")){for(var c=0,f=r.length;c<f;c++){var d,y=(d=$(r[c])).find("button.checkbox");if(y.hasClass("checked")&&(y.removeClass("partial").removeClass("checked"),"layer"==y.attr("name"))){var g=$(y).val(),v=i.getLayersByName(g)[0];void 0!==v&&v.setVisibility(!1)}}o&&0!=o.length&&o.find("button.checkbox").removeClass("partial").addClass("checked")}else o&&0!=o.length&&o.find("button.checkbox").removeClass("partial").removeClass("checked");u=s(o)}else u=s(t);else{var h=n(t),b=[];$.each(h,(function(t,a){var n=(a=$(a)).find("button.checkbox");if(e.hasClass("checked"))n.removeClass("partial").removeClass("checked"),a.hasClass("liz-layer")&&"layer"==n.attr("name")&&(s=$(n).val(),void 0!==(r=i.getLayersByName(s)[0])&&r.setVisibility(!1));else if(n.removeClass("partial").addClass("checked"),a.hasClass("liz-layer")&&"layer"==n.attr("name")){if(a.hasClass("mutually-exclusive")){var o=l(a).attr("id");if(-1!=b.indexOf(o))return void n.removeClass("partial").removeClass("checked");b.push(o)}var r,s=$(n).val();void 0!==(r=i.getLayersByName(s)[0])&&r.setVisibility(!0)}})),e.hasClass("checked")?e.removeClass("partial").removeClass("checked"):e.removeClass("partial").addClass("checked"),u=s(t)}$.each(u,(function(e,t){t=$(t);var n=0,i=0,o=0,r=a(t);$.each(r,(function(e,t){$(t).find("button.checkbox").each((function(e,t){(t=$(t)).hasClass("checked")?i++:t.hasClass("partial")&&t.hasClass("checked")&&o++,n++}))}));var l=t.find("button.checkbox");n==i?l.removeClass("partial").addClass("checked"):0==i&&0==o?l.removeClass("partial").removeClass("checked"):l.addClass("partial").addClass("checked")}))})),$("#switcher button.link").click((function(){var e=$(this);if(e.hasClass("disabled"))return!1;var t=e.val();/^(\/)?media\//.test(t)&&(t=OpenLayers.Util.urlAppend(lizUrls.media,OpenLayers.Util.getParameterString(lizUrls.params))+"&path=/"+t),window.open(t)})),$("#switcher button.removeCache").click((function(){var e=$(this);if(e.hasClass("disabled"))return!1;var t=OpenLayers.Util.urlAppend(lizUrls.removeCache,OpenLayers.Util.getParameterString(lizUrls.params))+"&layer="+e.val();confirm(lizDict["tree.button.removeCache"]+" ?")&&window.open(t)}));var m=i.projection,u=3e3,d=3e3;"wmsMaxWidth"in e.options&&e.options.wmsMaxWidth&&(u=Number(e.options.wmsMaxWidth)),"wmsMaxHeight"in e.options&&e.options.wmsMaxHeight&&(d=Number(e.options.wmsMaxHeight));var g=!1,v=i.size,h=new OpenLayers.Size(u,d);if(v.w>u||v.h>d){g=!0;var z=Math.max(u,d),O=Math.min(u,d),T=Math.max(v.w,v.h),x=Math.min(v.w,v.h);h=T/2>x?new OpenLayers.Size(Math.round(T/2),Math.round(T/2)):z/2>x?new OpenLayers.Size(Math.round(z/2),Math.round(z/2)):new OpenLayers.Size(Math.round(O/2),Math.round(O/2))}var E=[];o.reverse();for(var C=0,k=o.length;C<k;C++){var M=o[C];M.units=m.proj.units,g&&M instanceof OpenLayers.Layer.WMS&&M.singleTile&&M.addOptions({singleTile:!1,tileSize:h});try{i.addLayer(M);var N=M.name;M.name in f&&(N=L(M.name));var j=e.layers[N];E+=j?'<option value="'+M.name+'">'+j.title+"</option>":'<option value="'+M.name+'">'+M.name+"</option>"}catch(e){N=M.name,M.name in f&&(N=L(M.name)),console.log(N+" can't be added to the map!")}}if(0!=o.length){if($("#switcher-baselayer-select").append(E),$("#switcher-baselayer-select").change((function(){var e=$(this).val(),t=i.getLayersByName(e)[0];i.setBaseLayer(t),lizMap.events.triggerEvent("lizmapbaselayerchanged",{layer:t}),$(this).blur()})),1==o.length)$("#switcher-baselayer").hide();else if("startupBaselayer"in e.options){var I=e.options.startupBaselayer;I in c?I=c[I]:I in e.layers&&(I=b(I)),0!=$('#switcher-baselayer-select option[value="'+I+'"]').length&&$("#switcher-baselayer-select").val(I).change()}}else $("#switcher-baselayer").hide(),i.addLayer(new OpenLayers.Layer.Vector("baselayer",{maxExtent:i.maxExtent,maxScale:i.maxScale,minScale:i.minScale,numZoomLevels:i.numZoomLevels,scales:i.scales,projection:i.projection,units:i.projection.proj.units}));for(r.sort((function(e,t){return e.order==t.order?0:e.order>t.order?1:-1})),r.reverse(),C=0,k=r.length;C<k;C++){(_=r[C]).units=m.proj.units,_.events.on({loadstart:function(e){$("#layer-"+e.object.name+" span.loading").addClass("loadstart")},loadend:function(e){$("#layer-"+e.object.name+" span.loading").removeClass("loadstart")}}),N=null,_.name in f&&(N=L(_.name));var F=null;N&&(F=e.layers[N]),F||(F=e.layers[_.params.LAYERS]),F||(F=e.layers[_.name]),F&&(!("geometryType"in F)||"none"!=F.geometryType&&"unknown"!=F.geometryType&&""!=F.geometryType)&&(g&&_ instanceof OpenLayers.Layer.WMS&&_.singleTile&&_.addOptions({singleTile:!1,tileSize:h}),i.addLayer(_))}if("locateByLayer"in e){var A=[];for(var B in e.locateByLayer)"order"in e.locateByLayer[B]?A[e.locateByLayer[B].order]=B:A.push(B);var U=[];for(var _ in A){B=A[_];var Z=e.layers[B],D='<div class="locate-layer">';D+='<select id="locate-layer-'+b(B)+'" class="label">',D+="<option>"+Z.title+"...</option>",D+="</select>",D+="</div>",U.push(D)}$("#locate .menu-content").html(U.join("<hr/>")),i.addLayer(new OpenLayers.Layer.Vector("locatelayer",{styleMap:new OpenLayers.StyleMap({pointRadius:6,fill:!1,stroke:!0,strokeWidth:3,strokeColor:"yellow",strokeOpacity:.8})}));var G=le();if(0==G.length)e.locateByLayer={},$("#button-locate").parent().remove(),$("#locate-menu").remove();else{for(const t of G){var q=t.getElementsByTagName("Name")[0].textContent;if(!(B=lizMap.getNameByTypeName(q)))if(q in e.locateByLayer)B=q;else if(q in y&&y[q]in e.locateByLayer)B=y[q];else for(var V in e.locateByLayer)if(V.split(" ").join("_")==q){B=V;break}if(B in e.locateByLayer){(Y=e.locateByLayer[B]).crs=t.getElementsByTagName("SRS")[0].textContent,X(Y.crs,(function(){new OpenLayers.Projection(Y.crs)}));var H=t.getElementsByTagName("LatLongBoundingBox")[0];Y.bbox=[parseFloat(H.getAttribute("minx")),parseFloat(H.getAttribute("miny")),parseFloat(H.getAttribute("maxx")),parseFloat(H.getAttribute("maxy"))]}}for(var W in e.locateByLayer){var Y;if("vectorjoins"in(Y=e.locateByLayer[W])&&0!=Y.vectorjoins.length){var K=Y.vectorjoins[0];for(var Q in Y.joinFieldName=K.targetFieldName,e.locateByLayer){var J=e.locateByLayer[Q];J.layerId==K.joinLayerId&&(K.joinLayer=Q,Y.joinLayer=Q,J.joinFieldName=K.joinFieldName,J.joinLayer=W,J.filterjoins=[{targetFieldName:K.joinFieldName,joinFieldName:K.targetFieldName,joinLayerId:Y.layerId,joinLayer:W}])}}}for(var B in e.locateByLayer)R(B);$(".btn-locate-clear").click((function(){return P("locatelayer"),$("#locate select").val("-1"),$("div.locate-layer span > input").val(""),lizMap.lizmapLayerFilterActive&&lizMap.events.triggerEvent("lizmaplocatefeaturecanceled",{featureType:lizMap.lizmapLayerFilterActive}),!1})),$("#locate-close").click((function(){return $(".btn-locate-clear").click(),$("#button-locate").click(),!1}))}}$("#switcher span.label").tooltip({viewport:"#dock"})}function I(e){for(var t in l){var a=l[t];if(a){if(e&&"object"in e&&a==e.object)continue;a.type==OpenLayers.Control.TYPE_TOOL&&a.deactivate()}}return!0}function F(){var t=OpenLayers.Control.Permalink.prototype.createParams.apply(this,arguments);delete t.zoom,delete t.lat,delete t.lon,t.bbox=i.getExtent().toBBOX(),t.crs=i.projection.projCode;var a=[],n=[],o=[];for(var l in e.layers){var s=e.layers[l];"request_params"in s&&null!=s.request_params&&"filter"in s.request_params&&null!=s.request_params.filter&&""!=s.request_params.filter&&a.push(s.request_params.filter)}a.length>0&&(t.filter=a.join(";"));for(var p=0,m=r.length;p<m;p++){var u=r[p];!u.isVisible||"default"==u.params.STYLES&&""==u.params.STYLES||n.push(u.name+":"+u.params.STYLES),u.opacity&&1!=u.opacity&&o.push(u.name+":"+u.opacity)}return n.length>0&&(t.layerStyles=n.join(";")),o.length>0&&(t.layerOpacities=o.join(";")),v=t,t}function A(){var e={};if(window.location.search.length>1)for(var t,a=0,n=window.location.search.substr(1).split("&");a<n.length;a++)t=n[a].split("="),e[decodeURIComponent(t[0])]=t.length>1?decodeURIComponent(t[1]):"";return e}function B(){if($("#permaLink").hasClass("active")){var e=$("#permalink").attr("href");$("#input-share-permalink").val(e);var t=$("#select-embed-permalink").val();e=$("#permalink-embed").attr("href");var a="";"s"==t?a='<iframe width="400" height="300" frameborder="0" style="border:0" src="'+e+'" allowfullscreen></iframe>':"m"==t?a='<iframe width="600" height="450" frameborder="0" style="border:0" src="'+e+'" allowfullscreen></iframe>':"l"==t?a='<iframe width="800" height="600" frameborder="0" style="border:0" src="'+e+'" allowfullscreen></iframe>':"p"==t&&(a='<iframe width="'+$("#input-embed-width-permalink").val()+'" height="'+$("#input-embed-height-permalink").val()+'" frameborder="0" style="border:0" src="'+e+'" allowfullscreen></iframe>'),$("#input-embed-permalink").val(a)}}function U(t){if(B(),"visibility"==t.property){var a=L(t.layer.name),n=e.layers[a];lizMap.events.triggerEvent("lizmaplayerchangevisibility",{name:a,config:n,visibility:t.layer.visibility})}}function _(){$(".btn-geobookmark-del").click((function(){var e,t,a;confirm(lizDict["geobookmark.confirm.delete"])&&(e=$(this).val(),t=lizUrls.geobookmark,a={id:e,q:"del",repository:lizUrls.params.repository,project:lizUrls.params.project},$.get(t,a,(function(e){Z(e)}),"text"));return!1})),$(".btn-geobookmark-run").click((function(){return e=$(this).val(),t=lizUrls.geobookmark,a={id:e,q:"get"},$.get(t,a,(function(e){D(e)}),"json"),!1;var e,t,a}))}function Z(e){$("div#geobookmark-container").html(e),$("div#geobookmark-container button").unbind("click"),_(),$('#geobookmark-form input[name="bname"]').val("").blur()}function D(e){var t=e.layers,a={};if("layerStyles"in e&&""!=e.layerStyles){var n=e.layerStyles.split(";");for(var o in n)2==(s=n[o].split(":")).length&&(a[s[0]]=s[1])}var r={};if("layerOpacities"in e&&""!=e.layerOpacities){var l=e.layerOpacities.split(";");for(var o in l){var s;2==(s=l[o].split(":")).length&&(r[s[0]]=parseFloat(s[1]))}}for(o=0;o<i.layers.length;o++){var p=i.layers[o];if(p.isBaseLayer)"B"==t[o]&&$("#switcher-baselayer-select").val(p.name).change();else{var m=$('#switcher button.checkbox[name="layer"][value="'+p.name+'"]');"T"==t[o]!=m.hasClass("checked")&&$('#switcher button.checkbox[name="layer"][value="'+p.name+'"]').click()}p.name in a&&(p.params.STYLES=a[p.name],p.redraw(!0),lizMap.events.triggerEvent("layerstylechanged",{featureType:p.name})),p.name in r&&p.setOpacity(r[p.name])}if("filter"in e&&""!=e.filter){var u=e.filter.split(":");if(2==u.length){var c=u[0],f=u[1].split();lizMap.events.triggerEvent("layerfeatureselected",{featureType:c,fid:f,updateDrawing:!1}),lizMap.events.triggerEvent("layerfeaturefilterselected",{featureType:c})}}else lizMap.lizmapLayerFilterActive&&lizMap.events.triggerEvent("layerfeatureremovefilter",{featureType:lizMap.lizmapLayerFilterActive});var d=OpenLayers.Bounds.fromString(e.bbox);i.zoomToExtent(d,!0)}function G(e,t){P("locatelayer");var a=i.getLayersByName("locatelayer")[0];if(void 0!==a){var n="div.lizmapPopupContent div.lizmapPopupDiv > input.lizmap-popup-layer-feature-geometry";t&&(n="#"+t+" "+n);var o=[];$(n).each((function(){var e=$(this),t=e.val();if(""!=t){var a=e.parent().find("input.lizmap-popup-layer-feature-crs").val();if(""!=a){var n=e.parent().find("input.lizmap-popup-layer-feature-id").val(),i=e.parent().find("input.lizmap-popup-layer-feature-bbox-minx").val(),r=e.parent().find("input.lizmap-popup-layer-feature-bbox-miny").val(),l=e.parent().find("input.lizmap-popup-layer-feature-bbox-maxx").val(),s=e.parent().find("input.lizmap-popup-layer-feature-bbox-maxy").val();o.push({fid:n,geom:t,crs:a,bbox:[i,r,l,s]})}}}));for(var r=[],l=0,s=o.length;l<s;l++)X(o[l].crs,(function(e){if(r.push(e),r.length==o.length){for(var t=[],n=0,l=o.length;n<l;n++){var s=o[n],p=OpenLayers.Geometry.fromWKT(s.geom);p.transform(s.crs,i.getProjection()),t.push(new OpenLayers.Feature.Vector(p));var m=$('div.lizmapPopupContent input.lizmap-popup-layer-feature-id[value="'+s.fid+'"]');if(m){var u=OpenLayers.Bounds.fromArray(s.bbox);u.transform(s.crs,i.getProjection());var c="";c+='<button class="btn btn-mini popup-layer-feature-bbox-zoom" value="',c+=u.toString(),c+='" title="'+lizDict["attributeLayers.btn.zoom.title"]+'"><i class="icon-zoom-in"></i>&nbsp;</button>';var f=m.next("span.popupButtonBar");0!=f.length?0==f.find("button.popup-layer-feature-bbox-zoom").length&&f.append(c):(c='<span class="popupButtonBar">'+c+"</span></br>",m.after(c)),m.find("button.btn").tooltip({placement:"bottom"})}}a.addFeatures(t),$("div.lizmapPopupContent button.popup-layer-feature-bbox-zoom").unbind("click").click((function(){var e=OpenLayers.Bounds.fromString($(this).val());return i.zoomToExtent(e),!1})).hover((function(){$(this).addClass("btn-primary")}),(function(){$(this).removeClass("btn-primary")}))}}))}}function q(e,t){if(!("datavizLayers"in lizMap.config))return!1;var a="div.lizmapPopupContent div.lizmapPopupDiv";t&&(a="#"+t+" "+a),$(a).each((function(){var e=$(this);if($(this).find("div.lizdataviz").length>0)return!0;if($(this).find("input.lizmap-popup-layer-feature-id:first").val()){var t=$(this).find("input.lizmap-popup-layer-feature-id:first").val().split("."),a=t[0]+"_"+t[1],n=t[0],i=t[1],o=lizMap.getLayerConfigById(n);if(!o)return!0;var r=o[0];if(!("relations"in lizMap.config)||!(n in lizMap.config.relations))return!0;if(!("datavizLayers"in lizMap.config))return!0;lizMap.getLayerFeature(r,i,(function(i){var o=lizMap.config.datavizLayers.layers,r=lizMap.config.relations[n],l=1;for(var s in o)for(var p in r){var m=r[p],u=m.referencingLayer,c='"'+m.referencingField+"\" IN ('"+i.properties[m.referencedField]+"')";if(o[s].layer_id==u){var f=o[s];if("popup_display_child_plot"in f&&"True"==f.popup_display_child_plot){var d=o[s].plot_id;a=t[0]+"_"+t[1]+"_"+String(l),a+="_"+(new Date).valueOf()+btoa(Math.random()).substring(0,12);var y=lizDataviz.buildPlotContainerHtml(f.title,f.abstract,a,!1),g='<div class="lizmapPopupChildren lizdataviz">';g+="<h4>"+f.title+"</h4>",g+=y,g+="</div>";var v=$(e).find("div.lizmapPopupChildren:last");v.length>0?$(v).after(g):$(e).append(g),lizDataviz.getPlot(d,c,a),l++}}}}))}}))}function V(t,a){var n="div.lizmapPopupContent input.lizmap-popup-layer-feature-id";a&&(n="#"+a+" "+n),$(n).each((function(){var t=$(this),a=t.val(),n=a.split(".").pop(),i=a.replace("."+n,""),o=K(i);if(!o)return!0;var r=o[1],l=o[0];if(!("popupDisplayChildren"in r)||"True"!=r.popupDisplayChildren)return!0;if(!("relations"in e)||!(i in e.relations))return!0;var s=e.relations[i],p=10;"popupMaxFeatures"in r&&!isNaN(parseInt(r.popupMaxFeatures))&&(p=parseInt(r.popupMaxFeatures)),re(l,n,(function(e){const a=[],n=[];for(const r of s){const l=K(r.referencingLayer);if(l){const s=l[1];let m=s?.shortname||s.cleanname;if(void 0===m&&(m=b(configLayer.name),s.cleanname=m),"True"==s.popup&&0==t.parent().find("div.lizmapPopupChildren."+m).length){const l={LAYERS:m,QUERY_LAYERS:m,STYLES:"",SERVICE:"WMS",VERSION:"1.3.0",CRS:"crs"in s&&""!=s.crs?s.crs:"EPSG:4326",REQUEST:"GetFeatureInfo",EXCEPTIONS:"application/vnd.ogc.se_inimage",FEATURE_COUNT:p,INFO_FORMAT:"text/html"};"popupMaxFeatures"in s&&!isNaN(parseInt(s.popupMaxFeatures))&&(l.FEATURE_COUNT=parseInt(s.popupMaxFeatures)),0==l.FEATURE_COUNT&&(l.FEATURE_COUNT=p),s.request_params&&s.request_params.filter&&""!==s.request_params.filter?l.FILTER=s.request_params.filter+' AND "'+r.referencingField+"\" = '"+e.properties[r.referencedField]+"'":l.FILTER=m+':"'+r.referencingField+"\" = '"+e.properties[r.referencedField]+"'";var i=t.parent(),o=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));n.push(s),a.push(fetch(o,{method:"POST",body:new URLSearchParams(l)}).then((function(e){return e.text()})))}}}Promise.allSettled(a).then((e=>{childPopupElements=[];for(let t=0;t<e.length;t++){let p=e[t].value;if(p&&null!=p&&""!=p){var a=new RegExp("lizmapPopupTable","g");p=p.replace(a,"table table-condensed table-striped lizmapPopupTable");const e=n[t];var o=e.cleanname;void 0===o&&(o=b(e.name),e.cleanname=o);var r=$('<div class="lizmapPopupChildren '+o+'" data-layername="'+o+'" data-title="'+e.title+'">'+p+"</div>");if(-1!==["qgis","form"].indexOf(e.popupSource)&&0!=r.find(".lizmap_merged").length){r.find(".lizmapPopupDiv").each((function(e,t){var a=$(t);"TR"==a.find(".lizmapPopupHeader").prop("tagName")?(a.find(".lizmapPopupHeader").prepend("<th></th>"),a.find(".lizmapPopupHeader").next().prepend("<td></td>")):a.find(".lizmapPopupHeader").next().prepend("<span></span>"),a.find(".lizmapPopupHeader").next().children().first().append(a.find("input"))})),r.find("h4").each((function(e,t){0!=e&&$(t).remove()})),r.find(".lizmapPopupHeader").each((function(e,t){0!=e&&$(t).remove()})),r.find(".lizmapPopupDiv").contents().unwrap(),r.find(".lizmap_merged").contents().unwrap(),r.find(".lizmapPopupDiv").remove(),r.find(".lizmap_merged").remove(),r.find(".lizmapPopupHidden").hide();var l=$("<table class='lizmap_merged'></table>");r.append(l),r.find("tr").appendTo(l),r.children("tbody").remove()}var s=i.find("div.lizmapPopupChildren."+o);0!=s.length&&s.remove(),i.append(r),childPopupElements.push(r),lizMap.events.triggerEvent("lizmappopupchildrendisplayed",{html:r.html()})}}lizMap.events.triggerEvent("lizmappopupallchildrendisplayed",{parentPopupElement:t.parents(".lizmapPopupSingleFeature"),childPopupElements})}))}))}))}function H(e){for(var t=[],a=0,n=e.length;a<n;a++)t.push(parseFloat(e[a]));t.sort((function(e,t){return t-e}));var o=i.getScale(),r=$.inArray(o,t);if(-1==r){for(var l=0,s=t.length;-1==r&&l<s;)o>t[l]?r=l:l++;o=l==s?t[s-1]:t[r]}return o}function W(e,t,a){var n=e.size,o=i.getUnits(),r=OpenLayers.INCHES_PER_UNIT[o],l=n.width/72/r*a/2,s=n.height/72/r*a/2,p=!0;if("printInProjectProjection"in lizMap.config.options&&"True"!=lizMap.config.options.printInProjectProjection&&(p=!1),p&&lizMap.config.options.qgisProjectProjection.ref!=lizMap.config.options.projection.ref&&(l=96*l/72,s=96*s/72),0==t.features.length){var m=i.getCenter(),u=new OpenLayers.Bounds(m.lon-l,m.lat-s,m.lon+l,m.lat+s).toGeometry();t.addFeatures([new OpenLayers.Feature.Vector(u)])}else{var c=t.features[0];m=c.geometry.getBounds().getCenterLonLat(),(u=new OpenLayers.Bounds(m.lon-l,m.lat-s,m.lon+l,m.lat+s).toGeometry()).id=c.geometry.id,c.geometry=u,t.drawFeature(c)}return!0}function Y(e,t,a){var n=e.size,o=i.getUnits(),r=OpenLayers.INCHES_PER_UNIT[o],l=n.width/72/r*t,s=n.height/72/r*t,p=!0;"printInProjectProjection"in lizMap.config.options&&"True"!=lizMap.config.options.printInProjectProjection&&(p=!1),p&&lizMap.config.options.qgisProjectProjection.ref!=lizMap.config.options.projection.ref&&(l=96*l/72,s=96*s/72);for(var m=l>s?l:s,u=[],c=0,f=a.length;c<f;c++)u.push(parseFloat(a[c]));u.sort((function(e,t){return t-e}));var d=u[0];for(c=0,f=u.length;c<f;c++){var y=u[c];if(y>m&&(d=y),y<m)break}return d/10}function K(t,a,n){for(var i in n=void 0!==n?n:"id",a=void 0!==a?a:e.layers)if(a[i][n]==t)return[i,a[i]];return null}function X(e,t){var a=e.replace(/^\s+|\s+$/g,"");a in Proj4js.defs?t(a):$.get(OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params)),{REQUEST:"GetProj4",authid:a},(function(e){Proj4js.defs[a]=e,new OpenLayers.Projection(a),t(a)}))}function Q(){var e=$("body").parent()[0].offsetWidth;return e-450<450||e<450}function J(e,t,a){var n="info",i=!1;-1!=$.inArray(t,["info","error","success"])&&(n=t),a&&(i=!0);var o='<div class="alert alert-block alert-'+n+' fade in" data-alert="alert">';i&&(o+='<a class="close" data-dismiss="alert" href="#">×</a>'),o+="<p>"+e+"</p>",o+="</div>";var r=$(o);return $("#message").append(r),r}function ee(e,t,a){var n=new XMLHttpRequest;n.open("POST",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200===this.status){var e="",i=n.getResponseHeader("Content-Disposition");if(i&&-1!==i.indexOf("attachment")){var o=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(i);null!=o&&o[1]&&(e=o[1].replace(/['"]/g,""))}let t=n.getResponseHeader("Content-Type");navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"application/pdf"==t&&(t="application/octet-stream");const a=new File([this.response],e,{type:t}),r=URL.createObjectURL(a);if(e){const t=document.createElement("a");t.href=r,t.download=e,t.dispatchEvent(new MouseEvent("click"))}else window.open(r);setTimeout((()=>URL.revokeObjectURL(r)),100)}if(400==this.status){const e=/[\(\)]/g;if(t.TYPENAME.match(e)){var r="The selected features cannot be exported due to a known bug in QGIS Server.";r+="<br/>Please ask the map editor to remove the parenthesis in the layer name."}else r=lizDict["layer.export.unknown.export.error"];return J(r,"error",!0),!1}"function"==typeof a&&a()},n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send($.param(t,!0))}function te(t){var a="";if(t in e.layers&&e.layers[t].selectedFeatures){var n=[],i=e.layers[t],o=t.split(" ").join("_");for(var r in"shortname"in i&&""!=i.shortname&&(o=i.shortname),i.selectedFeatures)n.push(o+"."+i.selectedFeatures[r]);n.length&&(a=n.join())}return a}function ae(t,a,n,o,r,l,s){var p={};if(a=void 0!==a?a:null,n=void 0!==n?n:null,o=void 0!==o?o:null,r=void 0!==r&&r,l=void 0!==l?l:null,s=void 0!==s?s:null,!(t in e.layers)){var m=lizMap.getNameByCleanName(t);if(m&&m in e.layers||(m=lizMap.getNameByShortName(t)),m&&m in e.layers||(m=lizMap.getNameByTypeName(t)),!m||!(m in e.layers))return console.log('getVectorLayerWfsUrl: "'+t+'" and "'+m+'" not found in config'),!1;t=m}var u=e.layers[t],c=t.split(" ").join("_");"shortname"in u&&""!=u.shortname?c=u.shortname:"typename"in u&&""!=u.typename&&(c=u.typename);var f={SERVICE:"WFS",VERSION:"1.0.0",REQUEST:"GetFeature",TYPENAME:c,OUTPUTFORMAT:"GeoJSON"};l&&(f.STARTINDEX=l),s&&(f.MAXFEATURES=s);var d=[];if(a?""!=(a=a.replace(t+":",""))&&d.push(a):"request_params"in e.layers[t]&&"filter"in e.layers[t].request_params&&(a=e.layers[t].request_params.filter)&&(a=a.replace(t+":",""),d.push(a)),n?f.FEATUREID=n.replace(new RegExp(t,"g"),c):d.length&&(f.EXP_FILTER=d.join(" AND ")),r){var y=i.getExtent().clone(),g=new OpenLayers.Projection(e.layers[t].crs),v=(y=y.transform(i.getProjection(),g)).toBBOX();f.BBOX=v}return o&&-1!=$.inArray(o.toLowerCase(),["none","extent","centroid"])&&(f.GEOMETRYNAME=o),p.url=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params)),p.options=f,p}var ne={};function ie(e,t){var a=ne[e];delete ne[e],a.callbacks.forEach((function(e){e&&e(a.layerName,a.filter,t,a.alias)}))}function oe(t,a,n,i,o,r,l,s){if(a=void 0!==a?a:null,n=void 0!==n?n:null,i=void 0!==i?i:null,o=void 0!==o&&o,r=void 0!==r?r:null,l=void 0!==l?l:null,!(t in e.layers)){var p=lizMap.getNameByCleanName(t);if(p&&p in e.layers||(p=lizMap.getNameByShortName(t)),p&&p in e.layers||(p=lizMap.getNameByTypeName(t)),!p||!(p in e.layers))return console.log('getFeatureData: "'+t+'" and "'+p+'" not found in config'),!1;t=p}var m=e.layers[t];$("body").css("cursor","wait");var u=lizMap.getVectorLayerWfsUrl(t,a,n,i,o,r,l),c=u.url+"|"+JSON.stringify(u.options);if(!(c in ne))return ne[c]={callbacks:[s],layerName:t,filter:a,alias:m.alias},$.post(u.url,u.options,(function(a){if("featureCrs"in m||(m.featureCrs=null),"EPSG:4326"==m.crs&&(m.featureCrs="EPSG:4326"),m.featureCrs||0==a.features.length||lizMap.loadProjDefinition(m.crs,(function(){"qgisServerVersion"in e.options&&"2.14"!=e.options.qgisServerVersion?m.featureCrs="EPSG:4326":m.featureCrs||(m.featureCrs=m.crs)})),"alias"in m&&m.alias)ie(c,a.features),$("body").css("cursor","auto");else{var n=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));$.post(n,{SERVICE:"WFS",VERSION:"1.0.0",REQUEST:"DescribeFeatureType",TYPENAME:"typename"in m?m.typename:t,OUTPUTFORMAT:"JSON"},(function(e){m.alias=e.aliases,"types"in e&&(m.types=e.types),!("columns"in e)||"columns"in m&&m.columns||(m.columns=e.columns),ie(c,a.features),$("body").css("cursor","auto")}),"json")}}),"json"),!0;s&&ne[c].callbacks.push(s)}function re(t,a,n,i,o){if(n&&t in e.layers){var r=e.layers[t],l=t+"."+a;!o&&r.features&&a in r.features?n(r.features[a]):oe(t,null,l,"extent",!1,null,null,(function(e,o,l,s){if(1==l.length){var p=l[0];r.features||(r.features={}),r.features[a]=p,n(p)}else i&&i(t,a)}))}}function le(){return null==n?[]:n.getElementsByTagName("FeatureType")}function se(e,t,a,n,i){if($("#mapmenu .nav-list > li."+e+" > a").length)console.log(e+" menu item already exists");else{var o="";o+='<li class="'+e+" nav-"+a+'">',o+='   <a id="button-'+e+'" rel="tooltip" data-original-title="'+t+'" data-placement="right" href="#'+e+'" data-container="#content">',o+='       <span class="icon"><i class="'+i+' icon-white"></i></span><span class="menu-title">'+e+"</span>",o+="   </a>",o+="</li>",$("#mapmenu div ul li.nav-"+a+":last").after(o),0==$("#mapmenu div ul li.nav-"+a+"."+e).length&&$("#mapmenu div ul li:last").after(o),$("#mapmenu .nav-list > li."+e+" > a .icon").css("background-image","none"),$("#mapmenu .nav-list > li."+e+" > a .icon >i ").css("margin-left","4px"),$("#mapmenu .nav-list > li."+e+" > a").tooltip();var r="";r+='<div class="tab-pane" id="'+e+'">',"minidock"==a&&(r+='<div class="mini-dock-close" title="'+lizDict["toolbar.content.stop"]+'" style="padding:7px;float:right;cursor:pointer;"><i class="icon-remove icon-white"></i></div>',r+='    <div class="'+e+'">',r+="        <h3>",r+='            <span class="title">',r+='              <i class="'+i+' icon-white"></i>',r+='              <span class="text">&nbsp;'+t+"&nbsp;</span>",r+="            </span>",r+="        </h3>"),r+='        <div class="menu-content">',r+=n,r+="        </div>",r+="    </div>",r+="</div>","minidock"==a?($("#mini-dock-content").append(r),$("#"+e+" div.mini-dock-close").click((function(){$("#mapmenu .nav-list > li."+e).hasClass("active")&&$("#button-"+e).click()}))):"right-dock"==a?$("#right-dock-content").append(r):"dock"==a?$("#dock-content").append(r):"bottomdock"==a&&$("#bottom-dock-content").append(r);var l="";l+='<li id="nav-tab-'+e+'"><a href="#'+e+'" data-toggle="tab">'+t+"</a></li>","minidock"==a?$("#mini-dock-tabs").append(l):"right-dock"==a?$("#right-dock-tabs").append(l):"dock"==a?$("#dock-tabs").append(l):"bottomdock"==a&&$("#bottom-dock-tabs").append(l)}}var pe={map:null,layers:null,baselayers:null,events:null,config:null,dictionary:null,tree:null,lizmapLayerFilterActive:null,checkMobile:function(){return Q()},cleanName:function(e){return b(e)},getNameByCleanName:function(e){return function(e){var t=null;return e in f&&(t=f[e]),t}(e)},getNameByShortName:function(e){return function(e){var t=null;return e in y&&(t=y[e]),t}(e)},getNameByTypeName:function(e){return function(e){var t=null;return e in g&&(t=g[e]),t}(e)},getLayerNameByCleanName:function(e){return L(e)},addMessage:function(e,t,a){return J(e,t,a)},updateMiniDockSize:function(){return O()},loadProjDefinition:function(e,t){return X(e,t)},updateContentSize:function(){return z()},clearDrawLayer:function(e){return P(e)},getLayerFeature:function(e,t,a,n,i){re(e,t,a,n,i)},getFeatureData:function(e,t,a,n,i,o,r,l){oe(e,t,a,n,i,o,r,l)},translateWfsFieldValues:function(e,t,a,n){return function(e,t,a,n){return n=void 0!==n?n:null,a}(0,0,a,n)},zoomToFeature:function(t,a,n){!function(t,a,n){n=void 0!==n?n:"zoom";var o=new OpenLayers.Projection(e.layers[t].crs);e.layers[t].featureCrs&&(o=new OpenLayers.Projection(e.layers[t].featureCrs)),re(t,a,(function(e){!function(e,t,a){a=void 0!==a?a:"zoom";var n=new OpenLayers.Format.GeoJSON({ignoreExtraDims:!0}).read(e)[0];if(n&&"geometry"in n&&(n.geometry.transform(t,lizMap.map.getProjection()),"zoom"==a&&i.zoomToExtent(n.geometry.getBounds()),"center"==a)){var o=n.geometry.getBounds().getCenterLonLat();i.setCenter(o)}}(e,o,n)}))}(t,a,n)},getPrintGridInterval:function(e,t,a){return Y(e,t,a)},getPrintCapabilities:function(){return s},getExternalBaselayersReplacement:function(){return u},launchTooltipLayer:function(e){var t=$('#tooltip-layer-list option[value="'+e+'"]');return 1==t.length&&$("#tooltip-layer-list").val()!=e?$("#tooltip-layer-list").val(e).change():1!=t.length&&""!=$("#tooltip-layer-list").val()&&$("#tooltip-layer-list").val("").change(),$("#tooltip-layer-list").val()==e},launchEdition:function(){return!1},deleteEditionFeature:function(){return!1},deactivateToolControls:function(e){return I(e)},exportVectorLayer:function(e,t,a){return function(e,t,a){if(a=void 0!==a?a:null,!("exportLayers"in lizMap.config.options)||"True"!=lizMap.config.options.exportLayers)return J(lizDict["layer.export.right.required"],"error",!0),!1;t=void 0!==t?t:"GeoJSON";var n=L(lizMap.cleanName(e));n||(n=e);var i=lizMap.config.layers[n];const o=!(!i.geometryType||"none"==i.geometryType||"unknown"==i),r="request_params"in i&&"selectiontoken"in i.request_params&&null!=i.request_params.selectiontoken&&""!=i.request_params.selectiontoken,l=n.match(/[\(\)]/g);if(o&&r&&!l){var s=ae(e,null,null,null,a),p=i.request_params.selectiontoken;s.options.SELECTIONTOKEN=p}else s=ae(e,null,te(n),null,a);return s.options.dl=1,s.options.OUTPUTFORMAT=t,ee(s.url,s.options),!1}(e,t,a)},getVectorLayerWfsUrl:function(e,t,a,n,i){return ae(e,t,a,n,i)},getVectorLayerFeatureTypes:function(){return le()},getVectorLayerResultFormat:function(){return function(){let e=[];if(null==n)return e;for(const t of n.getElementsByTagName("ResultFormat")[0].children)e.push(t.tagName);return e}()},getLayerConfigById:function(e,t,a){return K(e,t,a)},getFeaturePopupContent:function(e,t,a){return function(e,t,a){if(a){if(!t)return!1;0!=lizMap.map.popups.length&&lizMap.map.removePopup(lizMap.map.popups[0]);var n,i=e;lizMap.getLayerNameByCleanName(e)&&(i=lizMap.getLayerNameByCleanName(e));var o=null;if(i in lizMap.config.attributeLayers&&(o=lizMap.config.attributeLayers[i].primaryKey),!o&&"atlasLayer"in lizMap.config.options&&"atlasPrimaryKey"in lizMap.config.options&&lizMap.config.layers[i].id==lizMap.config.options.atlasLayer&&""!=lizMap.config.options.atlasPrimaryKey&&(o=lizMap.config.options.atlasPrimaryKey),!o&&"atlas"in lizMap.config&&"layers"in lizMap.config.atlas&&Array.isArray(lizMap.config.atlas.layers)&&lizMap.config.atlas.layers.length>0){const e=lizMap.config.layers[i];for(let t=0;t<lizMap.config.atlas.layers.length;t++){const a=lizMap.config.atlas.layers[t];if(e.id===a.layer){o=a.primaryKey;break}}}if(!o)return!1;n=i+':"'+o+"\" = '"+t.properties[o]+"'";var r="EPSG:4326";"crs"in lizMap.config.layers[i]&&""!=lizMap.config.layers[i].crs&&(r=lizMap.config.layers[i].crs);var l={LAYERS:e,QUERY_LAYERS:e,STYLES:"",SERVICE:"WMS",VERSION:"1.3.0",CRS:r,REQUEST:"GetFeatureInfo",EXCEPTIONS:"application/vnd.ogc.se_inimage",INFO_FORMAT:"text/html",FEATURE_COUNT:1,FILTER:n},s=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));$.post(s,l,(function(e){a(e)}))}}(e,t,a)},getFeaturePopupContentByFeatureIntersection:function(e,t,a){return function(e,t,a){var n=lizMap.map.getUnits(),i=lizMap.config.layers[e];if("auto"==lizMap.map.maxScale)var o=i.minScale;else o=Math.max(lizMap.map.maxScale,i.minScale);o*=2;var r=OpenLayers.Util.getResolutionFromScale(o,n),l=t.geometry.CLASS_NAME;if("OpenLayers.Geometry.Polygon"==l||"OpenLayers.Geometry.MultiPolygon"==l||"OpenLayers.Geometry.Point"==l)var s=t.geometry.getBounds().getCenterLonLat();else{var p=t.geometry.getVertices(),m=p[Math.floor(p.length/2)];s=new OpenLayers.LonLat(m.x,m.y)}var u=new OpenLayers.Bounds(s.lon-5*r,s.lat-5*r,s.lon+5*r,s.lat+5*r),c=lizMap.map.getProjectionObject().toString();"EPSG:900913"==c&&(c="EPSG:3857");var f={LAYERS:e,QUERY_LAYERS:e,STYLES:"",SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",EXCEPTIONS:"application/vnd.ogc.se_inimage",BBOX:u.toBBOX(),FEATURE_COUNT:10,HEIGHT:100,WIDTH:100,INFO_FORMAT:"text/html",CRS:c,I:50,J:50},d=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));$.post(d,f,(function(e){a&&a(d,f,e)}))}(e,t,a)},selectLayerFeaturesFromSelectionFeature:function(t,a,n="intersects"){return function(t,a,n="intersects"){var i=e.layers[t];lizMap.loadProjDefinition(i.crs,(function(o){var r=new OpenLayers.Format.GML.v3({internalProjection:lizMap.map.getProjection(),externalProjection:o,srsName:o}),l=r.writeNode("feature:_geometry",a.geometry),s=n+"($geometry, geom_from_gml('";if(s+=OpenLayers.Format.XML.prototype.write.apply(r,l.children),s+="'))","request_params"in i&&"filter"in i.request_params){var p=i.request_params.filter;p&&(s=(p=p.replace(t+":",""))+" AND "+s)}if("request_params"in i&&"exp_filter"in i.request_params){var m=i.request_params.exp_filter;m&&(s=m+" AND "+s)}var u=!1;"limitDataToBbox"in e.options&&"True"==e.options.limitDataToBbox&&(u=!0);var c=lizMap.getVectorLayerWfsUrl(t,s,null,null,u);if("disjoint"!==n){var f=a.geometry.clone().transform(lizMap.map.getProjection(),o).getBounds();c.options.BBOX=f.toBBOX()}$.post(c.url,c.options,(function(a){var n=new OpenLayers.Format.GeoJSON({ignoreExtraDims:!0,externalProjection:i.crs,internalProjection:lizMap.map.getProjection()}).read(a),o=$.map(n,(function(e){return e.fid.split(".")[1]}));if("add"===lizMap.mainLizmap.selectionTool.newAddRemoveSelected){o=e.layers[t].selectedFeatures.concat(o);for(var r=0;r<o.length;++r)for(var l=r+1;l<o.length;++l)o[r]===o[l]&&o.splice(l--,1)}else if("remove"===lizMap.mainLizmap.selectionTool.newAddRemoveSelected){var s=e.layers[t].selectedFeatures.concat([]);for(r=0;r<o.length;++r){var p=s.indexOf(o[r]);-1!=p&&s.splice(p,1)}o=s}e.layers[t].selectedFeatures=o,lizMap.events.triggerEvent("layerSelectionChanged",{featureType:t,featureIds:e.layers[t].selectedFeatures,updateDrawing:!0})}))}))}(t,a,n)},addGeometryFeatureInfo:function(e,t){return G(0,t)},addChildrenFeatureInfo:function(e,t){return V(0,t)},addChildrenDatavizFilteredByPopupFeature:function(e,t){return q(0,t)},addDock:function(e,t,a,n,i){return se(e,t,a,n,i)},getHashParamFromUrl:function(e){var t=location.hash.replace("#","").split(",");for(var a in t){var n=t[a].split(":");if(2==n.length){var i=n[0],o=n[1];if(i==e)return o}}return null},triggerLayerFilter:function(t,a){return function(t,a){var n=t,o=null,r=i.getLayersByName(b(t));if(1==r.length&&(o=r[0]),!o)return!1;if(o.params&&(n=o.params.LAYERS),a&&""!=a)l=n+":"+a;else{a=null;var l=null}o.params.FILTER=l,"request_params"in e.layers[t]||(e.layers[t].request_params={}),e.layers[t].request_params.exp_filter=a;var s=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params)),p={service:"WMS",request:"GETFILTERTOKEN",typename:t,filter:l};return $.post(s,p,(function(a){var n=a.token;delete o.params.FILTER,o.params.FILTERTOKEN=n,e.layers[t].request_params.filtertoken=n,e.layers[t].geometryType&&"none"!=e.layers[t].geometryType&&"unknown"!=e.layers[t].geometryType&&o.redraw(),lizMap.events.triggerEvent("layerFilterParamChanged",{featureType:t,filter:l,updateDrawing:!1})})),!0}(t,a)},deactivateMaplayerFilter:function(t){return function(t){var a=null,n=i.getLayersByName(b(t));1==n.length&&(a=n[0]),delete a.params.FILTER,delete a.params.FILTERTOKEN,delete a.params.EXP_FILTER,"request_params"in e.layers[t]||(e.layers[t].request_params={}),e.layers[t].request_params.exp_filter=null,e.layers[t].request_params.filtertoken=null,e.layers[t].request_params.filter=null,a.redraw()}(t)},init:function(){var c=this,h=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));const T=fetch(OpenLayers.Util.urlAppend(lizUrls.config,OpenLayers.Util.getParameterString(lizUrls.params))).then((function(e){return e.json()})),x=fetch(OpenLayers.Util.urlAppend(h,OpenLayers.Util.getParameterString({SERVICE:"WMS",REQUEST:"GetCapabilities",VERSION:"1.3.0"}))).then((function(e){return e.text()})),k=fetch(OpenLayers.Util.urlAppend(h,OpenLayers.Util.getParameterString({SERVICE:"WMTS",REQUEST:"GetCapabilities",VERSION:"1.0.0"}))).then((function(e){return e.text()})),w=fetch(OpenLayers.Util.urlAppend(h,OpenLayers.Util.getParameterString({SERVICE:"WFS",REQUEST:"GetCapabilities",VERSION:"1.0.0"}))).then((function(e){return e.text()}));Promise.all([T,x,k,w]).then((h=>{e=h[0];const T=new DOMParser,x=h[1],k=h[2],w=h[3];if(e.options.hasOverview=!1,"useLayerIDs"in e.options&&"True"==e.options.useLayerIDs)for(var M in e.layers){var N=e.layers[M];d[N.id]=M}for(var M in e.layers)"shortname"in(N=e.layers[M])&&""!=N.shortname&&(y[N.shortname]=M),N.cleanname=b(M);if(R=x,ae=new OpenLayers.Format.WMSCapabilities({version:"1.3.0"}),!(t=ae.read(R)).capability&&($("#map").html("SERVICE NON DISPONIBLE!"),1))return!0;var R,ae,ne=new OpenLayers.Format.WMTSCapabilities({});if("exceptionReport"in(a=ne.read(k))){var ie=$("#metadata-wmts-getcapabilities-url");0!=ie.length&&ie.before('<i title="'+a.exceptionReport.exceptions[0].texts[0]+'" class="icon-warning-sign"></i>&nbsp;'),a=null}n=T.parseFromString(w,"application/xml");var re=le();for(const t of re){var pe=t.getElementsByTagName("Name")[0].textContent;if(!(M=lizMap.getNameByTypeName(pe)))if(pe in e.layers)M=pe;else if(pe in y&&y[pe]in e.layers)M=y[pe];else for(Se in e.layers)if(Se.split(" ").join("_")==pe){M=Se;break}M in e.layers&&((N=e.layers[M]).typename=pe,g[pe]=M)}$("#abstract").html(t.abstract?t.abstract:"");var me=t.capability;e.options.qgisProjectProjection=Object.assign({},e.options.projection),function(){if("osmMapnik"in e.options&&"True"==e.options.osmMapnik||"osmStamenToner"in e.options&&"True"==e.options.osmStamenToner||"osmCyclemap"in e.options&&"True"==e.options.osmCyclemap&&"OCMKey"in e.options||"googleStreets"in e.options&&"True"==e.options.googleStreets||"googleSatellite"in e.options&&"True"==e.options.googleSatellite||"googleHybrid"in e.options&&"True"==e.options.googleHybrid||"googleTerrain"in e.options&&"True"==e.options.googleTerrain||"bingStreets"in e.options&&"True"==e.options.bingStreets&&"bingKey"in e.options||"bingSatellite"in e.options&&"True"==e.options.bingSatellite&&"bingKey"in e.options||"bingHybrid"in e.options&&"True"==e.options.bingHybrid&&"bingKey"in e.options||"ignTerrain"in e.options&&"True"==e.options.ignTerrain||"ignStreets"in e.options&&"True"==e.options.ignStreets||"ignSatellite"in e.options&&"True"==e.options.ignSatellite||"ignCadastral"in e.options&&"True"==e.options.ignCadastral){Proj4js.defs["EPSG:3857"]=Proj4js.defs["EPSG:900913"];var t=e.options.projection;t.ref in Proj4js.defs||(Proj4js.defs[t.ref]=t.proj4);var a=new OpenLayers.Projection(t.ref),n=new OpenLayers.Projection("EPSG:3857");t.ref="EPSG:3857",t.proj4=Proj4js.defs["EPSG:3857"];var i=e.options.bbox,o=new OpenLayers.Bounds(Number(i[0]),Number(i[1]),Number(i[2]),Number(i[3]));i=(o=o.transform(a,n)).toArray();var r=[];if("mapScales"in e.options&&(r=e.options.mapScales),0==r.length&&(r=[e.options.maxScale,e.options.minScale]),e.options.projection=t,e.options.bbox=i,e.options.zoomLevelNumber=16,"initialExtent"in e.options&&4==e.options.initialExtent.length){var l=e.options.initialExtent,s=new OpenLayers.Bounds(Number(l[0]),Number(l[1]),Number(l[2]),Number(l[3]));s=s.transform(a,n),e.options.initialExtent=s.toArray()}("osmMapnik"in e.options&&"True"==e.options.osmMapnik||"osmStamenToner"in e.options&&"True"==e.options.osmStamenToner||"osmCyclemap"in e.options&&"True"==e.options.osmCyclemap&&"OCMKey"in e.options||"bingStreets"in e.options&&"True"==e.options.bingStreets&&"bingKey"in e.options||"bingSatellite"in e.options&&"True"==e.options.bingSatellite&&"bingKey"in e.options||"bingHybrid"in e.options&&"True"==e.options.bingHybrid&&"bingKey"in e.options||"ignTerrain"in e.options&&"True"==e.options.ignTerrain||"ignStreets"in e.options&&"True"==e.options.ignStreets)&&(e.options.zoomLevelNumber=23),("googleStreets"in e.options&&"True"==e.options.googleStreets||"googleHybrid"in e.options&&"True"==e.options.googleHybrid||"ignCadastral"in e.options&&"True"==e.options.ignCadastral)&&(e.options.zoomLevelNumber=20),"googleSatellite"in e.options&&"True"==e.options.googleSatellite&&(e.options.zoomLevelNumber=21),"ignSatellite"in e.options&&"True"==e.options.ignSatellite&&(e.options.zoomLevelNumber=22),e.options.maxScale=591659030.3224756,e.options.minScale=2257.0000851534865;var p="emptyBaselayer"in e.options&&"True"==e.options.emptyBaselayer;if(!p)for(var m in e.layers)if("True"==e.layers[m].baseLayer){p=!0;break}p&&(e.options.zoomLevelNumber=24);var u=[];if(0!=r.length){r.sort((function(e,t){return Number(t)-Number(e)}));for(var c=r[0],f=OpenLayers.Util.getResolutionFromScale(c,n.proj.units),d=r[r.length-1],y=OpenLayers.Util.getResolutionFromScale(d,n.proj.units),g=156543.03390625,v=1;g>y&&v<e.options.zoomLevelNumber;)g<f&&u.push(g),g/=2,v++;f=u[0],y=u[u.length-1],c=OpenLayers.Util.getScaleFromResolution(f,n.proj.units),d=OpenLayers.Util.getScaleFromResolution(y,n.proj.units)}e.options.resolutions=u,0!=u.length&&(e.options.zoomLevelNumber=u.length,e.options.maxScale=c,e.options.minScale=d)}}();var ue=me.nestedLayers[0];E(ue,p),C(p),c.config=e,c.tree=p,c.events.triggerEvent("treecreated",c),function(t){if(lizProj4)for(var a in lizProj4)a in Proj4js.defs||(Proj4js.defs[a]=lizProj4[a]);var n=e.options.projection;n.ref in Proj4js.defs||(Proj4js.defs[n.ref]=n.proj4);var i=new OpenLayers.Projection(n.ref);if(!(n.ref in OpenLayers.Projection.defaults)&&(OpenLayers.Projection.defaults[n.ref]=i,n.ref in t.bbox)){var o=t.bbox[n.ref].bbox,r=OpenLayers.Bounds.fromArray(o);OpenLayers.Bounds.fromArray(e.options.initialExtent).intersectsBounds(r)||(OpenLayers.Projection.defaults[n.ref].yx=!0)}}(ue),function(){var t=e.options.projection,a=new OpenLayers.Projection(t.ref),n=e.options.bbox,l=new OpenLayers.Bounds(Number(n[0]),Number(n[1]),Number(n[2]),Number(n[3])),s=l.scale(3),p=l.clone();if("initialExtent"in e.options&&4==e.options.initialExtent.length){var m=e.options.initialExtent;p=new OpenLayers.Bounds(Number(m[0]),Number(m[1]),Number(m[2]),Number(m[3]))}var u=$("body").parent()[0].clientHeight;u||(u=$("window").innerHeight()),u-=$("#header").height(),u-=$("#headermenu").height(),$("#map").height(u),z();var c=[],f=[];"resolutions"in e.options?f=e.options.resolutions:"mapScales"in e.options&&(c=e.options.mapScales),c.sort((function(e,t){return Number(t)-Number(e)}));for(var d=[];0!=c.length;){var y=c.pop(0);-1==$.inArray(y,d)&&d.push(y)}c=d,OpenLayers.Util.IMAGE_RELOAD_ATTEMPTS=3,OpenLayers.IMAGE_RELOAD_ATTEMPTS=3,OpenLayers.Util.DEFAULT_PRECISION=20,(i=new OpenLayers.Map("map",{controls:[new OpenLayers.Control.Navigation({mouseWheelOptions:{interval:100}})],tileManager:null,eventListeners:{zoomend:function(){var e="child-of-";function t(t){if(0==t.length)return null;for(var a=t[0].className.split(" "),n=0;n<a.length;n++)if(a[n].match(e))return $(t).siblings("#"+a[n].substring(e.length));return null}function a(e){for(var a=[];e=t(e);)a[a.length]=e[0];return a}for(var n=0,i=r.length;n<i;n++){var o=r[n],l=$('#switcher button[name="layer"][value="'+o.name+'"]').first();if(o.inRange&&l.hasClass("disabled")){(p=l.parents("tr").first()).removeClass("disabled").find("button").removeClass("disabled");var s=a(p);$.each(s,(function(e,t){$(t).removeClass("disabled").find("button").removeClass("disabled")})),p.find('button[name="layer"]').hasClass("checked")&&o.setVisibility(!0)}else if(!o.inRange&&!l.hasClass("disabled")){var p;(p=l.parents("tr").first()).addClass("disabled").find("button").addClass("disabled"),p.hasClass("liz-layer")&&p.collapse(),s=a(p),$.each(s,(function(e,t){t=$(t);var a,n=0,i=0,o=(a=t,$(a).siblings("tr.child-of-"+a[0].id));$.each(o,(function(e,t){$(t).find("button.checkbox").each((function(e,t){$(t).hasClass("disabled")&&i++,n++}))})),n==i?t.addClass("disabled").find("button").addClass("disabled"):t.removeClass("disabled").find("button").removeClass("disabled")}))}}$("#navbar button.pan").click()}},maxExtent:l,restrictedExtent:s,initialExtent:p,maxScale:0==c.length?e.options.minScale:"auto",minScale:0==c.length?e.options.maxScale:"auto",numZoomLevels:0==c.length?e.options.zoomLevelNumber:c.length,scales:0==c.length?null:c,resolutions:0==f.length?null:f,projection:a,units:null!==a.proj.units?a.proj.units:"degrees",allOverlays:0==o.length})).addControl(new OpenLayers.Control.Attribution({div:document.getElementById("attribution")})),window.addEventListener("resize",z)}(),c.map=i,c.layers=r,c.baselayers=o,c.controls=l,c.events.triggerEvent("mapcreated",c),j(),c.events.triggerEvent("layersadded",c);var ce=i.layers[i.layers.length-1].getZIndex();ce>i.Z_INDEX_BASE.Feature-100&&(i.Z_INDEX_BASE.Feature=ce+100,i.Z_INDEX_BASE.Popup=i.Z_INDEX_BASE.Feature+25,i.Z_INDEX_BASE.Popup>i.Z_INDEX_BASE.Control-25&&(i.Z_INDEX_BASE.Control=i.Z_INDEX_BASE.Popup+25));var fe,de,ye=!0,ge=OpenLayers.Util.getParameters(window.location.href);if(!i.getCenter()){if(ge.bbox||ge.BBOX){var ve=null;if(ge.bbox&&(ve=OpenLayers.Bounds.fromArray(ge.bbox)),ge.BBOX&&(ve=OpenLayers.Bounds.fromArray(ge.BBOX)),ge.crs&&ge.crs!=i.getProjection()&&ve.transform(ge.crs,i.getProjection()),ge.CRS&&ge.CRS!=i.getProjection()&&ve.transform(ge.CRS,i.getProjection()),i.restrictedExtent.containsBounds(ve))i.zoomToExtent(ve,!0);else{var he=$("#metadata .bbox").text();(he=OpenLayers.Bounds.fromString(he)).containsBounds(ve)?X($("#metadata .proj").text(),(function(e){ve.transform(e,i.getProjection()),i.zoomToExtent(ve,!0)})):i.zoomToExtent(i.initialExtent)}}else i.zoomToExtent(i.initialExtent);ye=!1}z(),i.events.triggerEvent("zoomend",{zoomChanged:!0}),function(){if($("#navbar div.slider").height(Math.max(50,5*i.numZoomLevels)).slider({orientation:"vertical",min:0,max:i.numZoomLevels-1,change:function(e,t){t.value>i.baseLayer.numZoomLevels-1?($("#navbar div.slider").slider("value",i.getZoom()),$("#zoom-in-max-msg").show("slow",(function(){window.setTimeout((function(){$("#zoom-in-max-msg").hide("slow")}),1e3)}))):t.value!=i.zoom&&i.zoomTo(t.value)}}),$("#navbar button.pan").click((function(){var e=$(this);if(e.hasClass("active"))return!1;$("#navbar button.zoom").removeClass("active"),e.addClass("active");var t=i.getControlsByClass("OpenLayers.Control.Navigation")[0];t.zoomBox.keyMask=t.zoomBoxKeyMask,t.zoomBox.handler.keyMask=t.zoomBoxKeyMask,t.zoomBox.handler.dragHandler.keyMask=t.zoomBoxKeyMask,t.handlers.wheel.activate(),"edition"in l&&l.edition.active||!("featureInfo"in l)||null===l.featureInfo||l.featureInfo.activate()})),$("#navbar button.zoom").click((function(){var e=$(this);if(e.hasClass("active"))return!1;$("#navbar button.pan").removeClass("active"),e.addClass("active"),"featureInfo"in l&&null!==l.featureInfo&&l.featureInfo.deactivate();var t=i.getControlsByClass("OpenLayers.Control.Navigation")[0];t.handlers.wheel.deactivate(),t.zoomBox.keyMask=null,t.zoomBox.handler.keyMask=null,t.zoomBox.handler.dragHandler.keyMask=null})),$("#navbar button.zoom-extent").click((function(){var e=A();"layers"in e?D(e):i.zoomToExtent(i.initialExtent)})),$("#navbar button.zoom-in").click((function(){i.getZoom()==i.baseLayer.numZoomLevels-1?$("#zoom-in-max-msg").show("slow",(function(){window.setTimeout((function(){$("#zoom-in-max-msg").hide("slow")}),1e3)})):i.zoomIn()})),$("#navbar button.zoom-out").click((function(){i.zoomOut()})),"zoomHistory"in e.options&&"True"==e.options.zoomHistory){var t=new OpenLayers.Control.NavigationHistory;i.addControls([t]),$("#navbar button.previous").click((function(){var e=i.getControlsByClass("OpenLayers.Control.NavigationHistory")[0];e&&0!=e.previousStack.length&&e.previousTrigger(),e&&e.previous.active?$(this).removeClass("disabled"):$(this).addClass("disabled"),e&&e.next.active?$("#navbar button.next").removeClass("disabled"):$("#navbar button.next").addClass("disabled")})),$("#navbar button.next").click((function(){var e=i.getControlsByClass("OpenLayers.Control.NavigationHistory")[0];e&&0!=e.nextStack.length&&e.nextTrigger(),e&&e.next.active?$(this).removeClass("disabled"):$(this).addClass("disabled"),e&&e.previous.active?$("#navbar button.previous").removeClass("disabled"):$("#navbar button.previous").addClass("disabled")})),i.events.on({moveend:function(){var e=i.getControlsByClass("OpenLayers.Control.NavigationHistory")[0];e&&0!=e.previousStack.length?$("#navbar button.previous").removeClass("disabled"):$("#navbar button.previous").addClass("disabled"),e&&0!=e.nextStack.length?$("#navbar button.next").removeClass("disabled"):$("#navbar button.next").addClass("disabled")}})}else $("#navbar > .history").remove()}(),fe=e.options,de=function(){var t=!1;for(var a in e.layers){var n=e.layers[a],o=null;if("editionLayers"in e&&a in e.editionLayers&&(o=e.editionLayers[a]),n&&n.popup&&"True"==n.popup||o&&("True"==o.capabilities.modifyGeometry||"True"==o.capabilities.modifyAttribute||"True"==o.capabilities.deleteFeature)){t=!0;break}}if(!t)return null;if("popupLocation"in e.options&&"map"!=e.options.popupLocation&&!$("#mapmenu .nav-list > li.popupcontent > a").length){"popup.msg.start"in lizDict||(lizDict["popup.msg.start"]="Click to the map to get informations.");var r='<div class="lizmapPopupContent"><h4>'+lizDict["popup.msg.start"]+"</h4></div>";se("popupcontent","Popup",e.options.popupLocation,r,"icon-comment"),$("#button-popupcontent").click((function(){$(this).parent().hasClass("active")&&(P("locatelayer"),$("#popupcontent div.menu-content").html('<div class="lizmapPopupContent"><h4>'+lizDict["popup.msg.start"]+"</h4></div>"))}))}var l,s=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params)),p=null,u=new OpenLayers.Control.WMSGetFeatureInfo({url:s,title:"Identify features by clicking",type:OpenLayers.Control.TYPE_TOGGLE,queryVisible:!0,infoFormat:"text/html",vendorParams:(l=m,"pointTolerance"in e.options&&"lineTolerance"in e.options&&"polygonTolerance"in e.options&&(l={FI_POINT_TOLERANCE:e.options.pointTolerance,FI_LINE_TOLERANCE:e.options.lineTolerance,FI_POLYGON_TOLERANCE:e.options.polygonTolerance}),l),handlerOptions:{click:{pixelTolerance:10}},eventListeners:{getfeatureinfo:function(t){var a=i.getLonLatFromPixel(t.xy),n=t.text;0!=i.popups.length&&i.removePopup(i.popups[0]);var o=null,r=null;if("popupLocation"in e.options&&"map"!=e.options.popupLocation){r="popupcontent";var l=new RegExp("lizmapPopupTable","g"),s='<div class="lizmapPopupContent">'+(n=n.replace(l,"table table-condensed table-striped table-bordered lizmapPopupTable"))+"</div>",m=!(!n||null==n||""==n);$("#popupcontent div.menu-content").html(s),$("#mapmenu .nav-list > li.popupcontent").is(":visible")||$("#mapmenu .nav-list > li.popupcontent").show(),m||(s='<div class="lizmapPopupContent"><h4>'+lizDict["popup.msg.no.result"]+"</h4></div>",$("#popupcontent div.menu-content").html(s),window.setTimeout((function(){$("#mapmenu .nav-list > li.popupcontent").hasClass("active")&&"right-dock"!=e.options.popupLocation&&$("#button-popupcontent").click()}),2e3)),$("#mapmenu .nav-list > li.popupcontent").hasClass("active")||!(!Q()||Q()&&m)||null!=p&&a.lon==p.lon&&a.lat==p.lat?$("#mapmenu .nav-list > li.popupcontent").hasClass("active")&&Q()&&m&&$("#button-popupcontent").click():$("#button-popupcontent").click(),$("#mapmenu .nav-list > li.popupcontent").hasClass("active")&&"minidock"==e.options.popupLocation&&O()}else{if(!n||null==n||""==n)return!1;r="liz_layer_popup",(o=new OpenLayers.Popup.LizmapAnchored(r,a,null,n,null,!0,(function(){return i.removePopup(this),Q()&&($("#navbar").show(),$("#overview-box").show()),P("locatelayer"),!1}))).panMapIfOutOfView=!0,i.addPopup(o),$("#"+r+' a[data-toggle="tab"]').on("click",(function(e){e.preventDefault(),$(this).tab("show")})),o.verifySize(),Q()&&($("#navbar").hide(),$("#overview-box").hide())}p=a,V(0,r),G(0,r),q(0,r),lizMap.events.triggerEvent("lizmappopupdisplayed",{popup:o,containerId:r})}}});if(lizUrls.publicUrlList&&0!=lizUrls.publicUrlList.length){for(var c=[],d=0,y=lizUrls.publicUrlList.length;d<y;d++)c.push(OpenLayers.Util.urlAppend(lizUrls.publicUrlList[d],OpenLayers.Util.getParameterString(lizUrls.params)));u.layerUrls=c}function g(e){if(e.updateDrawing){if(null==p)return!0;var t=i.getPixelFromLonLat(p);if(!($("#liz_layer_popup  div.lizmapPopupContent").length<1&&$("#popupcontent div.menu-content div.lizmapPopupContent").length<1)){var a="liz_layer_popup";0==$("#"+a+" div.lizmapPopupContent input.lizmap-popup-layer-feature-id").length&&(a="popupcontent");var n=!1;$("#"+a+" div.lizmapPopupContent input.lizmap-popup-layer-feature-id").each((function(){var t=$(this).val(),a=t.split(".").pop(),i=t.replace("."+a,""),o=lizMap.getLayerConfigById(i);if(o&&o[0]==e.featureType)return n=!0,!1})),n&&($("#"+a+' div.lizmapPopupContent input.lizmap-popup-layer-feature-id[value="'+e.layerId+"."+e.featureId+'"]').parent().remove(),u.request(t,{}))}}}return u.findLayers=function(){for(var t,a,n=this.layers||this.map.layers,i=[],o=0,r=0,l=n.length;r<l;++r)if(((t=n[r])instanceof OpenLayers.Layer.WMS||t instanceof OpenLayers.Layer.WMTS)&&(!this.queryVisible||t.getVisibility()&&t.calculateInRange())){var s=null;t.name in f&&(s=L(t.name));var p=null;s&&(p=e.layers[s]),p||(p=e.layers[t.params.LAYERS]),p||(p=e.layers[t.name]);var m=null;"editionLayers"in e&&((m=e.editionLayers[s])||(m=e.editionLayers[t.params.LAYERS]),m||(m=e.editionLayers[t.name])),(p&&p.popup&&"True"==p.popup||m&&("True"==m.capabilities.modifyGeometry||"True"==m.capabilities.modifyAttribute||"True"==m.capabilities.deleteFeature))&&(a=OpenLayers.Util.isArray(t.url)?t.url[0]:t.url,!1!==this.drillDown||this.url||(this.url=a),i.push(t),"popupMaxFeatures"in p&&!isNaN(parseInt(p.popupMaxFeatures))?o+=parseInt(p.popupMaxFeatures):o+=10)}return this.maxFeatures=0==o?10:o,i},lizMap.events.on({layerFilterParamChanged:function(t){var a=[];for(var n in e.layers){var i=e.layers[n];if("True"==i.popup&&"request_params"in i&&null!=i.request_params){var o=i.request_params;if("filter"in i.request_params&&null!=i.request_params.filter&&""!=i.request_params.filter){var r=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params)),l={service:"WMS",request:"GETFILTERTOKEN",typename:n,filter:i.request_params.filter};$.post(r,l,(function(e){a.push(e.token),u.vendorParams.filtertoken=a.join(";"),u.vendorParams.filter=null,g(t)}))}else u.vendorParams.filtertoken=o.filtertoken,u.vendorParams.filter=o.filter}}},layerSelectionChanged:function(e){g(e)},lizmapeditionfeaturedeleted:function(t){if($("div.lizmapPopupContent input.lizmap-popup-layer-feature-id").length>1)g(t);else if(0!=i.popups.length&&i.removePopup(i.popups[0]),"popupLocation"in e.options&&"map"!=e.options.popupLocation){var a='<div class="lizmapPopupContent"><h4>'+lizDict["popup.msg.no.result"]+"</h4></div>";$("#popupcontent div.menu-content").html(a),$("#mapmenu .nav-list > li.popupcontent").hasClass("active")&&$("#button-popupcontent").click(),$("#mapmenu .nav-list > li.popupcontent").hasClass("active")||$("#mapmenu .nav-list > li.popupcontent").hide()}}}),i.addControl(u),u.activate(),u}(),l.featureInfo=de,"print"in fe&&"True"==fe.print?function(){if(!e.printTemplates||0==e.printTemplates.length)return $("#button-print").parent().remove(),!1;for(var t=[],a=0,n=e.printTemplates.length;a<n;a++)"atlas"in(g=e.printTemplates[a])&&"enabled"in g.atlas&&("1"===g.atlas.enabled||"true"===g.atlas.enabled)||t.push(g);if(0==t.length)return $("#button-print").parent().remove(),!1;var o=.35277,r=i.scales;if(e.options.mapScales.length>2&&(r=e.options.mapScales),null==r&&null!=i.resolutions)for(r=[],a=0,n=i.resolutions.length;a<n;a++){var p=i.getUnits(),m=i.resolutions[a],c=OpenLayers.Util.getScaleFromResolution(m,p);r.push(c)}if(null==r)return $("#button-print").parent().remove(),!1;r[0]<r[r.length-1]&&r.reverse();var d="";for(a=0,n=r.length;a<n;a++){c=r[a],s.scales.push(c);var y=c;y=(y=y>10?Math.round(y):Math.round(100*y)/100).toLocaleString(),d+='<option value="'+c+'">'+y+"</option>"}for($("#print-scale").html(d),a=0,n=t.length;a<n;a++){for(var g=t[a],v=null,h=0,b=null;null==v&&h<g.maps.length;)(v=g.maps[h]).overviewMap&&(b=g.maps[h],v=null,h+=1);if(null!=v){var z=Number(v.width)/o,S=Number(v.height)/o;s.layouts.push({name:g.title,map:{width:z,height:S},size:{width:z,height:S},rotation:!1,template:g,mapId:v.id,overviewId:null!=b?b.id:null,grid:"grid"in v&&"True"==v.grid})}}if(0==s.layouts.length)return $("#button-print").parent().remove(),!1;var T=i.getLayersByName("Print");for(0==T.length?(T=new OpenLayers.Layer.Vector("Print",{styleMap:new OpenLayers.StyleMap({default:new OpenLayers.Style({fillColor:"#D43B19",fillOpacity:.2,strokeColor:"#CE1F2D",strokeWidth:1})})}),i.addLayer(T),T.setVisibility(!1)):T=T[0],a=0,n=s.layouts.length;a<n;a++){var x=s.layouts[a];$("#print-template").append('<option value="'+a+'">'+x.name+"</option>")}var E=new OpenLayers.Control.DragFeature(T,{geometryTypes:["OpenLayers.Geometry.Polygon"],type:OpenLayers.Control.TYPE_TOOL,layout:null,eventListeners:{activate:function(e){if(null==this.layout)return!1;I(e);var t=this.layout,a=H(s.scales);$("#print-scale").val(a),W(t,T,a),J(lizDict["print.activate"],"info",!0).addClass("print"),T.setVisibility(!0)},deactivate:function(){T.setVisibility(!1),$("#message .print").remove(),this.layout=null,T.destroyFeatures()}}});i.addControls([E]),l.printDrag=E,$("#print-template").change((function(){var e=$(this),t=s.layouts[parseInt(e.val())];if(0!=t.template.labels.length){for(var a="",n=0,i=t.template.labels.length;n<i;n++){var o=t.template.labels[n];a+=0==o.htmlState?'<input type="text" name="'+o.id+'" class="print-label" placeholder="'+o.text+'" value="'+o.text+'"><br>':'<textarea name="'+o.id+'" class="print-label" placeholder="'+o.text+'">'+o.text+"</textarea><br>"}$("#print .print-labels").html(a),$("#print .print-labels").show()}else $("#print .print-labels").html(""),$("#print .print-labels").hide();return O(),E.active?(E.deactivate(),E.layout=t,E.activate()):(E.layout=t,E.activate()),!1})),$("#print button.btn-print-clear").click((function(){return $("#button-print").click(),!1})),$("#print-scale").change((function(){if(E.active&&T.getVisibility()){var e=$(this),t=parseFloat(e.val());W(E.layout,T,t)}})),$("#print-launch").click((function(){var t=E.layout.template,a=[];"tables"in t&&(a=$.map(t.tables,(function(e){if(-1==e.composerMap||"map"+e.composerMap==E.layout.mapId)return e.vectorLayer})));var n=new OpenLayers.Bounds(E.layer.features[0].geometry.getBounds().toArray()),o=i.projection.getCode(),r=null,l=!0;if("printInProjectProjection"in lizMap.config.options&&"True"!=lizMap.config.options.printInProjectProjection&&(l=!1),l&&lizMap.config.options.qgisProjectProjection.ref!=lizMap.config.options.projection.ref){var p=e.options.qgisProjectProjection;p.ref in Proj4js.defs||(Proj4js.defs[p.ref]=p.proj4),o=(r=new OpenLayers.Projection(p.ref)).getCode(),n.transform(i.projection,r)}var m=OpenLayers.Projection.defaults[o]&&OpenLayers.Projection.defaults[o].yx,d=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));let y={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetPrint"};if(y.FORMAT=document.querySelector("#print-format").value,y.EXCEPTIONS="application/vnd.ogc.se_inimage",y.TRANSPARENT="true",y.SRS=o,y.DPI=document.querySelector("#print-dpi").value,y.TEMPLATE=t.title,y[E.layout.mapId+":extent"]=n.toBBOX(null,m),y[E.layout.mapId+":scale"]=document.querySelector("#print-scale").value,"grid"in E.layout&&E.layout.grid){var g=Y(E.layout,parseFloat(c),s.scales);y[E.layout.mapId+":grid_interval_x="]=g,y[E.layout.mapId+":grid_interval_y="]=g}var v=[],h=[],b=[];$.each(i.layers,(function(t,a){if((a instanceof OpenLayers.Layer.WMS||a instanceof OpenLayers.Layer.WMTS)&&a.getVisibility()&&"params"in a&&"LAYERS"in a.params){var n=null;a.name in f&&(n=L(a.name));var i=null;if(n&&(i=e.layers[n]),i||(i=e.layers[a.params.LAYERS]),i||(i=e.layers[a.name]),!i)return;if(!("id"in i))return;v.push(a.params.LAYERS);var o="default";"qgisServerVersion"in e.options&&e.options.qgisServerVersion.startsWith("3.")&&(o=""),"STYLES"in a.params&&a.params.STYLES.length>0&&(o=a.params.STYLES),h.push(o),i&&"opacity"in i?b.push(parseInt(255*a.opacity*i.opacity)):b.push(parseInt(255*a.opacity))}})),v.reverse(),h.reverse(),b.reverse();var z=i.baseLayer.name;if(z in u){var O=u[z];if(O in e.layers){var S=e.layers[O];"id"in S&&"useLayerIDs"in e.options&&"True"==e.options.useLayerIDs?v.push(S.id):v.push(O),"qgisServerVersion"in e.options&&e.options.qgisServerVersion.startsWith("3.")?h.push(""):h.push("default"),b.push(255)}}if(a.length>0&&$.each(a,(function(t,a){var n=K(a);if(n){var i=n[1];"none"!=i.geometryType&&"unknown"!=i.geometryType&&""!=i.geometryType||("shortname"in i&&""!=i.shortname?v.push(i.shortname):v.push(i.name),"qgisServerVersion"in e.options&&e.options.qgisServerVersion.startsWith("3.")?h.push(""):h.push("default"),b.push(255))}})),"qgisServerVersion"in e.options&&"2.14"!=e.options.qgisServerVersion&&(v.reverse(),h.reverse(),b.reverse()),y[E.layout.mapId+":LAYERS"]=v.join(","),y[E.layout.mapId+":STYLES"]=h.join(","),null!=E.layout.overviewId&&e.options.hasOverview){var T=e.options.bbox,x=new OpenLayers.Bounds(Number(T[0]),Number(T[1]),Number(T[2]),Number(T[3]));l&&lizMap.config.options.qgisProjectProjection.ref!=lizMap.config.options.projection.ref&&x.transform(i.projection,r),y[E.layout.overviewId+":extent"]=x,y[E.layout.overviewId+":LAYERS"]="Overview","qgisServerVersion"in e.options&&"2.14"!=e.options.qgisServerVersion?(v.push("Overview"),e.options.qgisServerVersion.startsWith("3.")?h.push(""):h.push("default"),b.push(255)):(v.unshift("Overview"),h.unshift("default"),b.unshift(255))}y.LAYERS=v.join(","),y.STYLES=h.join(","),y.OPACITIES=b.join(",");const C=document.querySelectorAll("#print .print-labels .print-label");if(C)for(const e of C)y[e.name]=e.value;var k=[],w=[];for(var M in e.layers){var P=e.layers[M],N=P.request_params;"request_params"in P&&null!=N&&("filtertoken"in N&&null!=N.filtertoken&&""!=N.filtertoken&&k.push(N.filtertoken),"selectiontoken"in N&&null!=N.selectiontoken&&""!=N.selectiontoken&&w.push(N.selectiontoken))}0!=k.length&&(y.FILTERTOKEN=k.join(";")),0!=w.length&&(y.SELECTIONTOKEN=w.join(";"));const R=new OpenLayers.Format.WKT,j=[],I=[];if(lizMap.mainLizmap.digitizing.featureDrawn&&lizMap.mainLizmap.digitizing.featureDrawnVisibility)for(let e=0;e<lizMap.mainLizmap.digitizing.featureDrawn.length;e++){var F=lizMap.mainLizmap.digitizing.featureDrawn[e];l&&lizMap.config.options.qgisProjectProjection.ref!=lizMap.config.options.projection.ref&&F.geometry.transform(i.projection,r),j.push(R.write(F)),I.push(lizMap.mainLizmap.digitizing.getFeatureDrawnSLD(e))}j.length>0&&(y[E.layout.mapId+":HIGHLIGHT_GEOM"]=j.join(";"),y[E.layout.mapId+":HIGHLIGHT_SYMBOL"]=I.join(";"));const A=document.getElementById("print-launch");return A.disabled=!0,A.classList.add("spinner"),$("#message .print a").click(),J(lizDict["print.started"],"info",!0).addClass("print-in-progress"),ee(d,y,(()=>{const e=document.getElementById("print-launch");e.disabled=!1,e.classList.remove("spinner"),$("#message .print-in-progress a").click()})),!1})),i.events.on({zoomend:function(){if(E.active&&T.getVisibility()){var e=H(s.scales);$("#print-scale").val(e),W(E.layout,T,e)}}}),lizMap.events.on({minidockopened:function(e){"print"==e.id&&$("#print-template").change()},minidockclosed:function(e){"print"==e.id&&E.deactivate()}})}():$("#button-print").parent().remove(),e.tooltipLayers&&0!=e.tooltipLayers.length?function(){if(!e.tooltipLayers||0==e.tooltipLayers.length)return $("#button-tooltip-layer").parent().remove(),!1;var t=le();if(0==t.length)return $("#button-tooltip-layer").parent().remove(),!1;var a={};for(var n in e.tooltipLayers)a[lizMap.cleanName(n)]=n;var i=[];for(const a of t){var o=a.getElementsByTagName("Name")[0].textContent;if(!(n=lizMap.getNameByTypeName(o)))if(o in e.locateByLayer)n=o;else if(o in y&&y[o]in e.locateByLayer)n=y[o];else for(var r in e.tooltipLayers)if(r.split(" ").join("_")==o){n=r;break}if(n in e.tooltipLayers&&n in e.tooltipLayers&&n in e.layers){var s=e.layers[n];i[e.tooltipLayers[n].order]='<option value="'+n+'">'+s.title+"</option>"}}for(var p=0;p<i.length;p++)$("#tooltip-layer-list").append(i[p]);if(1==$("#tooltip-layer-list").find("option").length)return $("#button-tooltip-layer").parent().remove(),!1;var m=new OpenLayers.StyleMap({default:new OpenLayers.Style({pointRadius:1,strokeColor:"blue",strokeWidth:10,strokeOpacity:0,fillOpacity:0,cursor:"pointer"}),selected:new OpenLayers.Style({pointRadius:1,strokeColor:"yellow",strokeWidth:10,strokeOpacity:0,fillOpacity:0,cursor:"pointer"}),temporary:new OpenLayers.Style({pointRadius:1,strokeColor:"red",strokeWidth:10,strokeOpacity:0,fillOpacity:0,cursor:"pointer"})}),u=new OpenLayers.Layer.Vector("tooltipLayer",{styleMap:m});lizMap.map.addLayer(u),u.setVisibility(!0);var c=new OpenLayers.Control.HighlightFeature([u],{displayPopup:!0,popupOffset:{left:45,right:0,top:5},popupTitle:"State information",popupSize:new OpenLayers.Size(200,375),style:{pointRadius:6,strokeColor:"cyan",strokeWidth:3,strokeOpacity:1,fillOpacity:.2,fillColor:"transparent"}});c.addInfoPopup=function(e){var t=$("#tooltip-layer-list").val(),a=lizMap.config.layers[t];if(t in lizMap.config.layers){var n=lizMap.config.tooltipLayers[t].fields.trim(),i=n.split(/[\s,]+/),o=[];"attributeLayers"in lizMap.config&&t in lizMap.config.attributeLayers&&"hiddenFields"in lizMap.config.attributeLayers[t]&&(o=lizMap.config.attributeLayers[t].hiddenFields.trim().split(/[\s,]+/));var r=a.alias,l='<div id="tooltipPopupContent">';for(var s in l+='<table class="lizmapPopupTable">',e.attributes)$.inArray(s,o)>-1||(""==n||$.inArray(s,i)>-1)&&(l+="<tr><th>"+r[s]+"</th><td>"+e.attributes[s]+"</td></tr>");l+="</table>",l+="</div>";var p=this.layer.map.getExtent(),m=this.layer.map.getResolution(),u=new OpenLayers.LonLat(p.left,p.top);u.lon+=($("#dock").width()+this.popupOffset.left)*m;var c=new OpenLayers.Popup.Anchored("tooltipPopup",u,null,l,{size:{w:14,h:14},offset:{x:-7,y:-7}},!1);c.autoSize=!0,c.backgroundColor="transparent",e.popup=c,lizMap.map.addPopup(c)}},lizMap.map.addControl(c),l["tooltip-layer"]=c,$("#tooltip-layer button.btn-tooltip-layer-clear").click((function(){return $("#button-tooltip-layer").click(),!1})),$("#tooltip-cancel").click((function(){return $("#tooltip-layer-list").val("").change(),!1})),$("#tooltip-layer-list").change((function(){var t=$(this).val();if(c.deactivate(),u.destroyFeatures(),""!=t){$("#tooltip-layer-list").addClass("loading").attr("disabled","");var a=L(t);a||(a=t);var n=te(a);oe(t,null,n,null,!1,null,null,(function(a,n,i,o){if(!(a in e.layers)){var r=lizMap.getNameByCleanName(t);if(!r||!(r in e.layers))return console.log('getFeatureData: "'+a+'" and "'+r+'" not found in config'),!1;a=r}var l=e.layers[a],s=e.tooltipLayers[a],p=new OpenLayers.Format.GeoJSON({ignoreExtraDims:!0,externalProjection:l.featureCrs,internalProjection:lizMap.map.getProjection()}).read({type:"FeatureCollection",features:i});u.addFeatures(p),"displayGeom"in s&&"True"==s.displayGeom?"colorGeom"in s&&""!=s.colorGeom?c.style.strokeColor=s.colorGeom:c.style.strokeColor="cyan":c.style.strokeColor="transparent",0!=p.length&&p[0].geometry&&p[0].geometry.id.startsWith("OpenLayers_Geometry_LineString")?c.style.strokeWidth=10:c.style.strokeWidth=3,c.activate(),$("#tooltip-layer-list").removeClass("loading").removeAttr("disabled")}))}})),$("#tooltip-layer-list").removeClass("loading").removeAttr("disabled"),lizMap.events.on({minidockopened:function(e){"tooltip-layer"==e.id&&2===$("#tooltip-layer-list option").length&&$("#tooltip-layer-list").val($("#tooltip-layer-list option:nth-child(2)").val()).change()},minidockclosed:function(e){if("tooltip-layer"==e.id)return $("#tooltip-layer-list").val("").change(),!1}})}():$("#button-tooltip-layer").parent().remove(),"geolocation"in fe&&"True"==fe.geolocation&&$("#geolocation button.btn-geolocation-close").click((function(){return $("#button-geolocation").click(),!1})),"measure"in fe&&"True"==fe.measure?function(){var e=new OpenLayers.Style;e.addRules([new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash",fillColor:"white",fillOpacity:.3}}})]);var t=new OpenLayers.StyleMap({default:e}),a={length:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{styleMap:t}},type:OpenLayers.Control.TYPE_TOOL}),area:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{styleMap:t}},type:OpenLayers.Control.TYPE_TOOL}),perimeter:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{styleMap:t}},type:OpenLayers.Control.TYPE_TOOL}),angle:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{id:"angleMeasure",persist:!0,geodesic:!0,immediate:!0,handlerOptions:{maxVertices:3,layerOptions:{styleMap:t}},type:OpenLayers.Control.TYPE_TOOL})};function n(e){var t=e.units,a=e.order,n=e.measure,i="";if("angleMeasure"===e.object.id){if(i=lizDict["measure.handle"]+" 0°",3===e.geometry.components.length){if(void 0===e.object.invert){const t=e.geometry.components[0].clone(),a=e.geometry.components[1].clone();e.geometry.components[0].move(a.x-t.x,a.y-t.y),e.geometry.components[1].move(t.x-a.x,t.y-a.y),e.object.invert=!0}else"measure"===e.type&&(e.object.invert=void 0);const t=e.geometry.components[0],a=e.geometry.components[1],n=e.geometry.components[2],o=Math.sqrt(Math.pow(a.x-t.x,2)+Math.pow(a.y-t.y,2)),r=Math.sqrt(Math.pow(a.x-n.x,2)+Math.pow(a.y-n.y,2)),l=Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2));let s=180*Math.acos((r*r+o*o-l*l)/(2*r*o))/Math.PI;isNaN(s)&&(s=0),i=lizDict["measure.handle"]+" "+s.toFixed(2)+"°"}}else i+=1==a?lizDict["measure.handle"]+" "+n.toFixed(3)+" "+t:lizDict["measure.handle"]+" "+n.toFixed(3)+" "+t+"<sup>2</sup>";var o=$("#lizmap-measure-message");0==o.length?(o=J(i)).attr("id","lizmap-measure-message"):o.html("<p>"+i+"</p>")}for(var o in a.length.events.on({activate:function(){J(lizDict["measure.activate.length"],"info",!0).attr("id","lizmap-measure-message")},deactivate:function(){$("#lizmap-measure-message").remove()}}),a.area.events.on({activate:function(){J(lizDict["measure.activate.area"],"info",!0).attr("id","lizmap-measure-message")},deactivate:function(){$("#lizmap-measure-message").remove()}}),a.perimeter.events.on({activate:function(){J(lizDict["measure.activate.perimeter"],"info",!0).attr("id","lizmap-measure-message")},deactivate:function(){$("#lizmap-measure-message").remove()}}),a.angle.events.on({activate:function(){J(lizDict["measure.activate.angle"],"info",!0).attr("id","lizmap-measure-message")},deactivate:function(){$("#lizmap-measure-message").remove()}}),a.perimeter.measure=function(e,t){var a,n;OpenLayers.Util.indexOf(e.CLASS_NAME,"LineString")>-1?(a=this.getBestLength(e),n=1):(a=this.getBestLength(e.components[0]),n=1),this.events.triggerEvent(t,{measure:a[0],units:a[1],order:n,geometry:e})},a){var r=a[o];r.events.on({measure:n,measurepartial:n}),i.addControl(r),l[o+"Measure"]=r}$("#measure-type").change((function(){var e=$(this);e.find("option").each((function(){var e=$(this).attr("value");e in a&&a[e].active&&a[e].deactivate()})),a[e.val()].activate()})),lizMap.events.on({minidockopened:function(e){"measure"==e.id&&$("#measure-type").change()},minidockclosed:function(e){if("measure"==e.id){var t="";$("#measure-type option").each((function(){var e=$(this).attr("value");e in a&&a[e].active&&(t=e)})),""!=t&&a[t].deactivate()}}}),$("#measure-stop").click((function(){$("#button-measure").click()}))}():($("#measure").parent().remove(),$("#measure-length-menu").remove(),$("#measure-area-menu").remove(),$("#measure-perimeter-menu").remove()),c.events.triggerEvent("toolbarcreated",c),function(){if(0!=$("#permalink").length){var t=new OpenLayers.Control.Permalink("permalink",null,{createParams:F});i.addControl(t);var a=new OpenLayers.Control.Permalink("permalink-embed",$("#permalink-embed").attr("href"),{createParams:F});i.addControl(a),i.events.on({changebaselayer:function(){$("#switcher-baselayer-select").val(i.baseLayer.name).change()},moveend:B,changelayer:U,changebaselayer:B}),$("#select-embed-permalink").change((function(){"p"==$(this).val()?$("#span-embed-personalized-permalink").show():$("#span-embed-personalized-permalink").hide(),B()})),$("#span-embed-personalized-permalink input").change(B),$(".btn-permalink-clear").click((function(){return $("#button-permaLink").click(),!1})),_(),$('#permalink-box ul.permalink-tabs a[data-toggle="tab"]').on("shown",(function(e){"#tab-embed-permalink"==$(e.target).attr("href")&&O()})),$("#geobookmark-form").submit((function(){var t=$('#geobookmark-form input[name="bname"]').val();if(""==t)return J(lizDict["geobookmark.name.required"],"error",!0),!1;var a=lizUrls.geobookmark,n=JSON.parse(JSON.stringify(v));if(n.name=t,n.q="add",lizMap.lizmapLayerFilterActive){var i=lizMap.lizmapLayerFilterActive+":"+e.layers[lizMap.lizmapLayerFilterActive].filteredFeatures.join();n.filter=i}return $.post(a,n,(function(e){Z(e)}),"text"),!1})),lizMap.events.on({minidockopened:function(e){"permaLink"==e.id&&B()}})}}();var be=!1,Le=A();if("layers"in Le){for(var ze=Le.layers,Oe=0;Oe<i.layers.length;Oe++)(Se=i.layers[Oe]).isBaseLayer||"T"==ze[Oe]&&(be=!0,Se.setVisibility(!0));D(Le)}if($('#switcher button.checkbox[name="layer"]').each((function(){var e=$(this),t=e.val(),a=i.getLayersByName(t)[0];a&&(e.toggleClass("checked",a.visibility),e.hasClass("checked")||!a.isVisible||be||e.click())})),ye){i.getControlsByClass("OpenLayers.Control.ArgParser")[0].configureLayers(),Oe=0;for(var $e=r.length;Oe<$e;Oe++){var Se=r[Oe],Te=$('#switcher button.checkbox[name="layer"][value="'+Se.name+'"]');ge.layers&&Se.getVisibility()!=Te.hasClass("checked")&&$('#switcher button.checkbox[name="layer"][value="'+Se.name+'"]').click()}}$('#switcher button.checkbox.disabled[name="layer"]:not(.checked)').each((function(){var t=$(this),a=t.val(),n=a;a in f&&(n=L(a)),n in e.layers&&"True"==e.layers[n].toggled&&t.addClass("checked")})),$("#navbar div.slider").slider("value",i.getZoom()),i.events.on({zoomend:function(){$("#switcher table.tree tr.legendGraphics.initialized").each((function(){var e=$(this),t=S(e.attr("id").replace("legend-",""),!0);null!=t&&""!=t&&(e.find("div.legendGraphics img").attr("data-src",t),e.hasClass("visible")&&e.find("div.legendGraphics img").attr("src",t))})),$("#navbar div.slider").slider("value",this.getZoom())}}),lizMap.events.on({layerstylechanged:function(e){var t=e.featureType,a=S(t,!0);if(null!=a&&""!=a){var n="#switcher table.tree tr#legend-"+t+" div.legendGraphics img";$(n).attr("data-src",a),$("#switcher table.tree tr#legend-"+t).hasClass("visible")&&$(n).attr("src",a)}}}),$("#mapmenu ul").on("click","li.nav-minidock > a",(function(){var e=$(this),t=e.parent(),a=e.attr("href").substr(1),n=$("#nav-tab-"+a);if(t.hasClass("active"))$("#"+a).removeClass("active"),n.removeClass("active"),t.removeClass("active"),lizMap.events.triggerEvent("minidockclosed",{id:a});else{var i=$("#mapmenu li.nav-minidock.active");0!=i.length&&(i.removeClass("active"),lizMap.events.triggerEvent("minidockclosed",{id:i.children("a").first().attr("href").substr(1)})),n.children("a").first().click(),t.addClass("active"),lizMap.events.triggerEvent("minidockopened",{id:a}),O()}return e.blur(),!1})),"locateByLayer"in e?$("#button-locate").click():$("#button-locate").parent().hide(),0==$("#mapmenu ul li.nav-minidock.active").length&&($("#mini-dock-content > .tab-pane.active").removeClass("active"),$("#mini-dock-tabs li.active").removeClass("active")),$("#mapmenu ul").on("click","li.nav-dock > a",(function(){var e=$(this),t=e.parent(),a=e.attr("href").substr(1),n=$("#nav-tab-"+a),i="";if(t.hasClass("active"))$("#"+a).removeClass("active"),n.removeClass("active"),t.removeClass("active"),i="dockclosed";else{var o=$("#mapmenu li.nav-dock.active");0!=o.length&&(o.removeClass("active"),lizMap.events.triggerEvent("dockclosed",{id:o.children("a").first().attr("href").substr(1)})),n.show(),n.children("a").first().click(),t.addClass("active"),i="dockopened"}e.blur();var r=$("#dock");return 0==$("#dock-tabs .active").length?r.hide():r.is(":visible")||r.show(),""!=i&&lizMap.events.triggerEvent(i,{id:a}),!1})),$("#mapmenu ul").on("click","li.nav-right-dock > a",(function(){var e=$(this),t=e.parent(),a=e.attr("href").substr(1),n=$("#nav-tab-"+a),i="";if(t.hasClass("active"))$("#"+a).removeClass("active"),n.removeClass("active"),t.removeClass("active"),i="rightdockclosed";else{var o=$("#mapmenu li.nav-right-dock.active");0!=o.length&&(o.removeClass("active"),lizMap.events.triggerEvent("rightdockclosed",{id:o.children("a").first().attr("href").substr(1)})),n.show(),n.children("a").first().click(),t.addClass("active"),i="rightdockopened"}e.blur();var r=$("#right-dock");return 0==$("#right-dock-tabs .active").length?(r.hide(),$("#content").removeClass("right-dock-visible"),z()):r.is(":visible")||($("#content").addClass("right-dock-visible"),r.show(),z()),""!=i&&lizMap.events.triggerEvent(i,{id:a}),!1})),$("#menuToggle").click((function(){$(this).toggleClass("opened")})),$("#menuToggle:visible ~ #mapmenu ul").on("click","li > a",(function(){$("#menuToggle").removeClass("opened")})),$("#button-switcher").click(),z(),$('#headermenu .navbar-inner .nav a[rel="tooltip"]').tooltip(),$('#mapmenu .nav a[rel="tooltip"]').tooltip(),c.events.triggerEvent("uicreated",c),$("body").css("cursor","auto"),$("#loading").dialog("close")}))}};return pe.events=new OpenLayers.Events(pe,null,["treecreated","mapcreated","layersadded","uicreated","dockopened","dockclosed"],!0,{includeXY:!0}),pe}(),lizMap.events.on({mapcreated:function(e){if("emptyBaselayer"in e.config.options&&"True"==e.config.options.emptyBaselayer&&((k={}).title=lizDict["baselayer.empty.title"],k.name="emptyBaselayer",e.config.layers.emptyBaselayer=k,e.baselayers.push(new OpenLayers.Layer.Vector("emptyBaselayer",{isBaseLayer:!0,maxExtent:e.map.maxExtent,maxScale:e.map.maxScale,minScale:e.map.minScale,numZoomLevels:e.map.numZoomLevels,scales:e.map.scales,projection:e.map.projection,units:e.map.projection.proj.units})),e.map.allOverlays=!1),"osmMapnik"in e.config.options&&"True"==e.config.options.osmMapnik||"osmStamenToner"in e.config.options&&"True"==e.config.options.osmStamenToner||"osmCyclemap"in e.config.options&&"True"==e.config.options.osmCyclemap&&"OCMKey"in e.config.options||"googleStreets"in e.config.options&&"True"==e.config.options.googleStreets||"googleSatellite"in e.config.options&&"True"==e.config.options.googleSatellite||"googleHybrid"in e.config.options&&"True"==e.config.options.googleHybrid||"googleTerrain"in e.config.options&&"True"==e.config.options.googleTerrain||"bingStreets"in e.config.options&&"True"==e.config.options.bingStreets&&"bingKey"in e.config.options||"bingSatellite"in e.config.options&&"True"==e.config.options.bingSatellite&&"bingKey"in e.config.options||"bingHybrid"in e.config.options&&"True"==e.config.options.bingHybrid&&"bingKey"in e.config.options||"ignTerrain"in e.config.options&&"True"==e.config.options.ignTerrain||"ignStreets"in e.config.options&&"True"==e.config.options.ignStreets||"ignSatellite"in e.config.options&&"True"==e.config.options.ignSatellite||"ignCadastral"in e.config.options&&"True"==e.config.options.ignCadastral){var t=null;OpenLayers.Projection.defaults["EPSG:900913"].maxExtent?t=new OpenLayers.Bounds(OpenLayers.Projection.defaults["EPSG:900913"].maxExtent):OpenLayers.Projection.defaults["EPSG:3857"].maxExtent&&(t=new OpenLayers.Bounds(OpenLayers.Projection.defaults["EPSG:3857"].maxExtent));var a={zoomOffset:0,maxResolution:156543.03390625};if("resolutions"in e.config.options&&0!=e.config.options.resolutions.length){for(var n=e.config.options.resolutions,i=n[0],o=n.length,r=0,l=156543.03390625;l>i;)r+=1,l=156543.03390625/Math.pow(2,r);a.zoomOffset=r,a.maxResolution=i,a.numZoomLevels=o}if("osmMapnik"in e.config.options&&"True"==e.config.options.osmMapnik){e.map.allOverlays=!1;var s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:23};0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var p=new OpenLayers.Layer.OSM("osm",["https://a.tile.openstreetmap.org/${z}/${x}/${y}.png","https://b.tile.openstreetmap.org/${z}/${x}/${y}.png","https://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],s);p.maxExtent=t,e.config.layers.osm={name:"osm",title:"OpenStreetMap",type:"baselayer"},e.baselayers.push(p)}if("osmStamenToner"in e.config.options&&"True"==e.config.options.osmStamenToner){e.map.allOverlays=!1,s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:23},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var m=new OpenLayers.Layer.OSM("osm-toner",["https://stamen-tiles-a.a.ssl.fastly.net/toner-lite/${z}/${x}/${y}.png","https://stamen-tiles-b.a.ssl.fastly.net/toner-lite/${z}/${x}/${y}.png","https://stamen-tiles-c.a.ssl.fastly.net/toner-lite/${z}/${x}/${y}.png","https://stamen-tiles-d.a.ssl.fastly.net/toner-lite/${z}/${x}/${y}.png"],s);m.maxExtent=t,e.config.layers["osm-toner"]={name:"osm-toner",title:"OSM Stamen Toner",type:"baselayer"},e.baselayers.push(m)}if("osmCyclemap"in e.config.options&&"True"==e.config.options.osmCyclemap&&"OCMKey"in e.config.options){e.map.allOverlays=!1,s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:23},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var u=new OpenLayers.Layer.OSM("osm-cyclemap","https://tile.thunderforest.com/cycle/${z}/${x}/${y}.png?apiKey="+e.config.options.OCMKey,s);u.maxExtent=t,e.config.layers["osm-cycle"]={name:"osm-cycle",title:"OSM CycleMap",type:"baselayer"},e.baselayers.push(u)}try{if("googleSatellite"in e.config.options&&"True"==e.config.options.googleSatellite){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:21},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var c=new OpenLayers.Layer.Google("gsat",{type:google.maps.MapTypeId.SATELLITE,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});c.maxExtent=t,e.config.layers.gsat={name:"gsat",title:"Google Satellite",type:"baselayer"},e.baselayers.push(c),e.map.allOverlays=!1,e.map.zoomDuration=0}if("googleHybrid"in e.config.options&&"True"==e.config.options.googleHybrid){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:20},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var f=new OpenLayers.Layer.Google("ghyb",{type:google.maps.MapTypeId.HYBRID,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});f.maxExtent=t,e.config.layers.ghyb={name:"ghyb",title:"Google Hybrid",type:"baselayer"},e.baselayers.push(f),e.map.allOverlays=!1,e.map.zoomDuration=0}if("googleTerrain"in e.config.options&&"True"==e.config.options.googleTerrain){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:16},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var d=new OpenLayers.Layer.Google("gphy",{type:google.maps.MapTypeId.TERRAIN,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});d.maxExtent=t,e.config.layers.gphy={name:"gphy",title:"Google Terrain",type:"baselayer"},e.baselayers.push(d),e.map.allOverlays=!1,e.map.zoomDuration=0}if("googleStreets"in e.config.options&&"True"==e.config.options.googleStreets){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:20},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var y=new OpenLayers.Layer.Google("gmap",{numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});y.maxExtent=t,e.config.layers.gmap={name:"gmap",title:"Google Streets",type:"baselayer"},e.baselayers.push(y),e.map.allOverlays=!1,e.map.zoomDuration=0}if("bingStreets"in e.config.options&&"True"==e.config.options.bingStreets&&"bingKey"in e.config.options){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:23},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var g=new OpenLayers.Layer.Bing({key:e.config.options.bingKey,type:"Road",name:"Bing Road",numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});g.maxExtent=t,e.config.layers.bmap={name:"bmap",title:"Bing Road",type:"baselayer"},e.baselayers.push(g),e.map.allOverlays=!1}if("bingSatellite"in e.config.options&&"True"==e.config.options.bingSatellite&&"bingKey"in e.config.options){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:23},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var v=new OpenLayers.Layer.Bing({key:e.config.options.bingKey,type:"Aerial",name:"Bing Aerial",numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});v.maxExtent=t,e.config.layers.baerial={name:"baerial",title:"Bing Aerial",type:"baselayer"},e.baselayers.push(v),e.map.allOverlays=!1}if("bingHybrid"in e.config.options&&"True"==e.config.options.bingHybrid&&"bingKey"in e.config.options){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:23},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var h=new OpenLayers.Layer.Bing({key:e.config.options.bingKey,type:"AerialWithLabels",name:"Bing Hybrid",numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});h.maxExtent=t,e.config.layers.bhybrid={name:"bhybrid",title:"Bing Hybrid",type:"baselayer"},e.baselayers.push(h),e.map.allOverlays=!1}var b='<a href="http://www.ign.fr" target="_blank"><img width="25" src="https://wxs.ign.fr/static/logos/IGN/IGN.gif" title="Institut national de l\'information géographique et forestière" alt="IGN"></a>';if("ignKey"in e.config.options){var L=e.config.options.ignKey;if("ignTerrain"in e.config.options&&"True"==e.config.options.ignTerrain){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:18},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var z=new OpenLayers.Layer.WMTS({name:"ignmap",url:"https://wxs.ign.fr/"+L+"/geoportail/wmts",layer:"GEOGRAPHICALGRIDSYSTEMS.MAPS",matrixSet:"PM",style:"normal",projection:new OpenLayers.Projection("EPSG:3857"),attribution:b,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset,zoomOffset:s.zoomOffset});z.maxExtent=t,e.config.layers.ignmap={name:"ignmap",title:"IGN Scan",type:"baselayer"},e.baselayers.push(z),e.map.allOverlays=!1}}if("ignStreets"in e.config.options&&"True"==e.config.options.ignStreets){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:18},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var O=new OpenLayers.Layer.WMTS({name:"ignplan",url:"https://wxs.ign.fr/cartes/geoportail/wmts",layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2",matrixSet:"PM",style:"normal",format:"image/png",projection:new OpenLayers.Projection("EPSG:3857"),attribution:b,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset,zoomOffset:s.zoomOffset});O.maxExtent=t,e.config.layers.ignplan={name:"ignplan",title:"IGN Plan",type:"baselayer"},e.baselayers.push(O),e.map.allOverlays=!1}if("ignSatellite"in e.config.options&&"True"==e.config.options.ignSatellite){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:22},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var $=new OpenLayers.Layer.WMTS({name:"ignphoto",url:"https://wxs.ign.fr/ortho/geoportail/wmts",layer:"ORTHOIMAGERY.ORTHOPHOTOS",matrixSet:"PM",style:"normal",projection:new OpenLayers.Projection("EPSG:3857"),attribution:b,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset,zoomOffset:s.zoomOffset});$.maxExtent=t,e.config.layers.ignphoto={name:"ignphoto",title:"IGN Photos",type:"baselayer"},e.baselayers.push($),e.map.allOverlays=!1}if("ignCadastral"in e.config.options&&"True"==e.config.options.ignCadastral){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:20},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var S=new OpenLayers.Layer.WMTS({name:"igncadastral",url:"https://wxs.ign.fr/parcellaire/geoportail/wmts",layer:"CADASTRALPARCELS.PARCELLAIRE_EXPRESS",matrixSet:"PM",style:"normal",format:"image/png",projection:new OpenLayers.Projection("EPSG:3857"),attribution:b,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset,zoomOffset:s.zoomOffset});S.maxExtent=t,e.config.layers.igncadastral={name:"igncadastral",title:"IGN Cadastre",type:"baselayer"},e.baselayers.push(S),e.map.allOverlays=!1}}catch(e){}}if("lizmapExternalBaselayers"in e.config){var T=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));if(lizUrls.publicUrlList&&lizUrls.publicUrlList.length>1){T=[];for(var x=0,E=lizUrls.publicUrlList.length;x<E;x++)T.push(OpenLayers.Util.urlAppend(lizUrls.publicUrlList[x],OpenLayers.Util.getParameterString(lizUrls.params)))}for(var C in e.config.lizmapExternalBaselayers){var k=e.config.lizmapExternalBaselayers[C];if("repository"in k&&"project"in k){var w=e.cleanName(k.layerName),M={layers:k.layerName,version:"1.3.0",exceptions:"application/vnd.ogc.se_inimage",format:k.layerImageFormat?"image/"+k.layerImageFormat:"image/png",dpi:96};"image/jpeg"!=M.format&&(M.transparent=!0);var P=new RegExp("repository=(.+)&project=(.+)","g");if(T instanceof Array)N=jQuery.map(T,(function(e){return e.replace(P,"repository="+k.repository+"&project="+k.project)}));else var N=T.replace(P,"repository="+k.repository+"&project="+k.project);k.title=k.layerTitle,k.name=k.layerName,k.baselayer=!0,k.singleTile="False",e.config.layers[w]=k,e.baselayers.push(new OpenLayers.Layer.WMS(w,N,M,{isBaseLayer:!0,gutter:"True"==k.cached?0:5,buffer:0,singleTile:"True"==k.singleTile,ratio:1})),e.map.allOverlays=!1}}}},uicreated:function(e){var t=e.map;t.id in OpenLayers.Layer.Google.cache&&google.maps.event.addListenerOnce(OpenLayers.Layer.Google.cache[t.id].mapObject,"tilesloaded",(function(){for(var e=t.layers,a=!1,n=e.length-1;n>=0;--n)if((i=e[n])instanceof OpenLayers.Layer.Google&&!0===i.visibility&&!0===i.inRange){i.redraw(!0),a=!0;break}if(!a)for(n=e.length-1;n>=0;--n){var i;if((i=e[n])instanceof OpenLayers.Layer.Google){i.display(!1);break}}})),lizMap.checkMobile()&&$("#button-switcher").parent().hasClass("active")&&$("#button-switcher").click(),$("#dock-close").click((function(){$("#mapmenu .nav-list > li.active.nav-dock > a").click()})),$("#right-dock-close").click((function(){$("#mapmenu .nav-list > li.active.nav-right-dock > a").click()}))}}),$(document).ready((function(){$("body").css("cursor","wait"),$("#loading").dialog({modal:!0,draggable:!1,resizable:!1,closeOnEscape:!1,dialogClass:"liz-dialog-wait",minHeight:128}).parent().removeClass("ui-corner-all").children(".ui-dialog-titlebar").removeClass("ui-corner-all"),OpenLayers.DOTS_PER_INCH=96,lizMap.init(),$("#loading").css("min-height","128px")}));
//# sourceMappingURL=map.js.map