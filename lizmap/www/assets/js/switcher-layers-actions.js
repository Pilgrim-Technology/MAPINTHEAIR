!function(){var e=null,a={};lizMap.events.on({uicreated:function(){if("themes"in lizMap.config){var t=lizMap.config.themes,i='<div id="theme-selector" class="btn-group" role="group">';for(var l in i+='<button class="btn btn-mini dropdown-toggle" data-toggle="dropdown" type="button" title="'+lizDict["switcherLayersActions.themeSelector.title"]+'" href="#"><i class="icon-none qgis_sprite mActionShowAllLayers"></i><span class="caret"></span></button>',i+='<ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu">',t)i+='<li class="theme"><a href="#">'+l+"</a></li>";i+="</ul>",i+="</div>",$("#switcher-layers-actions").prepend(i),$("#theme-selector").on("click",".theme",(function(){$("#theme-selector .theme").removeClass("selected"),$(this).addClass("selected");var e=$(this).text();if(e in lizMap.config.themes){var a=lizMap.config.themes[e];if($("#switcher-layers .liz-layer a.expander ~ button.checked").each((function(){$(this).hasClass("disabled")?$(this).removeClass("partial").removeClass("checked"):$(this).click()})),"layers"in a)for(var t in a.layers){var i=lizMap.getLayerConfigById(t);if(i){var l=i[0],s=l,n=i[1];"typename"in n&&(s=n.typename);var r=$("#switcher-layers #layer-"+n.cleanname+" a.expander ~ button");if(r.hasClass("disabled")?r.removeClass("partial").addClass("checked"):r.click(),"style"in a.layers[t]){var c=a.layers[t].style,o=lizMap.map.getLayersByName(lizMap.cleanName(l));if(0==o.length)continue;var p=o[0];p&&p.params&&(p.params.STYLES=c,p.redraw(!0),lizMap.events.triggerEvent("layerstylechanged",{featureType:s}))}}}lizMap.events.triggerEvent("mapthemechanged",{name:e,config:a})}})),lizMap.events.triggerEvent("mapthemesadded",{themes:t}),"activateFirstMapTheme"in lizMap.config.options&&"True"==lizMap.config.options.activateFirstMapTheme&&$("#theme-selector li.theme:nth-child(1)").click()}e=lizMap.getVectorLayerFeatureTypes(),$("#switcher-layers-actions .btn, #get-baselayer-metadata").tooltip({placement:"bottom"}),$("#layers-unfold-all").click((function(){return $("#switcher table.tree tr.collapsed:not(.liz-layer.disabled) a.expander").click(),!1})),$("#layers-fold-all").click((function(){return $("#switcher table.tree").collapseAll(),!1})),$("#get-baselayer-metadata").click((function(){if($("#hide-sub-dock").click(),!lizMap.map.baseLayer)return!1;var e=lizMap.map.baseLayer.name;return!!e&&(lizMap.events.triggerEvent("lizmapswitcheritemselected",{name:e,type:"baselayer",selected:!0}),!1)})),$("#content").on("click","button.layerActionZoom",(function(){var e=$(this).val();if(!e)return!1;var a=lizMap.config.layers[e];"baselayer"==a.type&&lizMap.map.zoomToMaxExtent();var t=lizMap.map.getProjection();if("EPSG:900913"==t&&(t="EPSG:3857"),!("bbox"in a)||!(t in a.bbox))return console.log("The layer bbox information has not been found in config"),console.log(a),!1;var i=a.bbox[t].bbox,l=new OpenLayers.Bounds(i[0],i[1],i[2],i[3]);return OpenLayers.Projection.defaults[t]&&OpenLayers.Projection.defaults[t].yx&&(l=new OpenLayers.Bounds(i[1],i[0],i[3],i[2])),lizMap.map.zoomToExtent(l),!1})),$("#content").on("change","select.styleLayer",(function(){var e=$(this).val(),a=$(this).parent().find("input.styleLayer"),t=a.val(),i=a.hasClass("baselayer");if(!t)return!1;var l=null;(l=i?lizMap.map.baseLayer:lizMap.map.getLayersByName(lizMap.cleanName(t))[0])&&l.params&&(l.params.STYLES=e,l.redraw(!0),lizMap.events.triggerEvent("layerstylechanged",{featureType:t}))})),$("#content").on("click","a.btn-opacity-layer",(function(){var e=$(this).text(),t=parseInt(e)/100,i=$(this).parent().find("input.opacityLayer"),l=i.val(),s=i.hasClass("baselayer");if(!l)return!1;var n=null;return(n=s?lizMap.map.baseLayer:lizMap.map.getLayersByName(lizMap.cleanName(l))[0])&&n.params&&(n.setOpacity(t),a[l]=t,$("a.btn-opacity-layer").removeClass("active"),$("a.btn-opacity-layer."+100*t).addClass("active")),$("#switcher").click(),!1})),$("#content").on("click","button.exportLayer",(function(){var e=$(this).val(),a=$(this).parent().find("select.exportLayer").val();return lizMap.exportVectorLayer(e,a),!1})),$("#layerActionUnfilter").click((function(){var e=lizMap.lizmapLayerFilterActive;return!!e&&(lizMap.events.triggerEvent("layerfeatureremovefilter",{featureType:e}),lizMap.lizmapLayerFilterActive=null,$(this).hide(),!1)})),lizMap.events.on({dockclosed:function(e){"switcher"==e.id&&$("#hide-sub-dock").click()},lizmapbaselayerchanged:function(e){if($("#sub-dock").is(":visible")){var a=$("#hide-sub-dock").val();0!=$("#switcher-baselayer-select").find('option[value="'+a+'"]').length&&a!=$("#switcher-baselayer-select").val()&&lizMap.events.triggerEvent("lizmapswitcheritemselected",{name:e.layer.name,type:"baselayer",selected:!0})}}})},lizmapswitcheritemselected:function(t){var i=t.name,l=t.type,s=t.selected,n={};if("baselayer"==l)(r=lizMap.getLayerNameByCleanName(lizMap.cleanName(i)))&&(i=r);else{var r;if(!(r=lizMap.getLayerNameByCleanName(lizMap.cleanName(i))))return!1;i=r,n=lizMap.config.layers[r]}var c=i;s||(c=""),$("#switcher-layers-actions button").val(c);var o=!s||!("bbox"in n);$("button.layerActionZoom").attr("disable",o).toggleClass("disabled",o),function(t,i){var l;i?(l=function(t){var i="",l={title:t,type:"layer",abstract:null,link:null,styles:null,isBaselayer:!1};if(t in lizMap.config.layers){var s=lizMap.config.layers[t];l.title=s.title,l.type=s.type,s.abstract&&(l.abstract=s.abstract),s.link&&(l.link=s.link),s.styles&&s.styles.length>1&&(l.styles=s.styles)}if(lizMap.map.baseLayer&&lizMap.map.baseLayer.name==t&&(l.type="layer",l.isBaselayer=!0),l){if(s=lizMap.config.layers[t],i+='<div class="sub-metadata">',i+="<h3>",i+='    <span class="title">',i+='        <span class="icon"></span>',i+='        <span class="text">'+lizDict["layer.metadata.title"]+"</span>",i+="    </span>",i+="</h3>",i+='<div class="menu-content">',i+='    <dl class="dl-vertical" style="font-size:0.8em;">',i+="        <dt>"+lizDict["layer.metadata.layer.name"]+"</dt>",i+="        <dd>"+l.title+"</dd>",i+="        <dt>"+lizDict["layer.metadata.layer.type"]+"</dt>",i+="        <dd>"+lizDict["layer.metadata.layer.type."+l.type]+"</dd>",i+="        <dt>"+lizDict["layer.metadata.zoomToExtent.title"]+"</dt>",i+='<dd><button class="btn btn-mini layerActionZoom" title="'+lizDict["layer.metadata.zoomToExtent.title"]+'" value="'+t+'"><i class="icon-zoom-in"></i></button></dd>',"layer"==l.type){var n="";if(l.isBaselayer&&(n="baselayer"),l.styles){var r="",c=lizMap.map.getLayersByName(lizMap.cleanName(t))[0];for(var o in c&&"STYLES"in c.params&&(r=c.params.STYLES),b="",l.styles)b+=(o=l.styles[o])==r?'<option value="'+o+'" selected>'+o+"</option>":'<option value="'+o+'">'+o+"</option>";""!=b&&(i+="        <dt>"+lizDict["layer.metadata.style.title"]+"</dt>",i+="<dd>",i+='<input type="hidden" class="styleLayer '+n+'" value="'+t+'">',i+='<select class="styleLayer '+n+'">',i+=b,i+="</select>",i+="</dd>")}i+="        <dt>"+lizDict["layer.metadata.opacity.title"]+"</dt>",i+="<dd>";var p=1;t in a&&(p=a[t]),i+='<input type="hidden" class="opacityLayer '+n+'" value="'+t+'">';var d=lizMap.config.options.layersOpacities;void 0===d&&(d=[.2,.4,.6,.8,1]);for(var y=0,m=d.length;y<m;y++){var u="";p==d[y]&&(u="active"),i+='<a href="#" class="btn btn-mini btn-opacity-layer '+u+" "+100*d[y]+'">'+100*d[y]+"</a>"}if(i+="</dd>","exportLayers"in lizMap.config.options&&"True"==lizMap.config.options.exportLayers&&null!=e&&0!=e.length){var v=lizMap.getVectorLayerResultFormat(),b="";for(y=0,m=v.length;y<m;y++){var h=v[y];b+='<option value="'+h+'">'+h+"</option>"}var f=!1;if(""!=b)for(const a of e){var z=a.getElementsByTagName("Name")[0].textContent;z!=t&&z!=t.split(" ").join("_")||(f=!0)}f&&(i+="        <dt>"+lizDict["layer.metadata.export.title"]+"</dt>",i+="<dd>",i+='<select class="exportLayer '+n+'">',i+=b,i+="</select>",i+='<button class="btn btn-mini exportLayer '+n+'" title="'+lizDict["layer.metadata.export.title"]+'" value="'+t+'"><i class="icon-download"></i></button>',i+="</dd>")}}l.abstract&&(i+="        <dt>"+lizDict["layer.metadata.layer.abstract"]+"</dt>",i+="        <dd>"+l.abstract+"</dd>"),i+="    </dl>",l.link&&(i+='    <button class="btn link layer-info" name="link" title="'+lizDict["layer.metadata.layer.info.see"]+'" value="'+l.link+'">'+lizDict["layer.metadata.layer.info.see"]+"</button>"),i+="</div>",i+="</div>",i+='<button id="hide-sub-dock" class="btn btn-mini pull-right" name="close" title="'+lizDict["generic.btn.close.title"]+'" value="'+t+'">'+lizDict["generic.btn.close.title"]+"</button>"}return i}(t),$("#sub-dock").html(l),$("#sub-dock a.btn-opacity-layer").each((function(){var e=$(this).text(),a=parseInt(e)/100-.3;$(this).css("background-color","rgba(0,0,0,"+a+")"),$(this).css("background-image","none"),$(this).css("text-shadow","none"),parseInt(e)>60&&$(this).css("color","lightgrey")})),$("div.sub-metadata button.link").click((function(){var e=$(this);if(e.hasClass("disabled"))return!1;var a=e.val();/^(\/)?media\//.test(a)&&(a=OpenLayers.Util.urlAppend(lizUrls.media,OpenLayers.Util.getParameterString(lizUrls.params))+"&path=/"+a),window.open(a)})),$("#hide-sub-dock").click((function(){var e=$(this).val(),a=lizMap.config.layers[e],t="baselayer";"type"in a&&(t=a.type),lizMap.events.triggerEvent("lizmapswitcheritemselected",{name:e,type:t,selected:!1}),$("#switcher tr.selected").removeClass("selected")})),"none"!=$("#sub-dock").css("display")||$("#sub-dock").show()):$("#sub-dock").hide().html("")}(i,s)}})}();
//# sourceMappingURL=switcher-layers-actions.js.map