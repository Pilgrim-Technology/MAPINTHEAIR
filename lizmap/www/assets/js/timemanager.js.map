{"version":3,"file":"../../lizmap/www/assets/js/timemanager.js","mappings":"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","sources":["webpack://assets/./src/legacy/timemanager.js"],"sourcesContent":["var lizTimemanager = function() {\n\n    lizMap.events.on({\n        'uicreated':function(evt){\n\n            // Attributes\n            var config = lizMap.config;\n            var layers = lizMap.layers;\n            var tmActive = false;\n            var tmLayersNumber = 0;\n            var tmLayerIndex = 0;\n            var tmLayersDataFetched = 0;\n            var tmLayersReady = false;\n\n            if (!('timemanagerLayers' in config))\n              return -1;\n\n            // Count layers\n            tmLayersNumber = Object.keys(lizMap.config.timemanagerLayers).length;\n\n            $('#timemanager-menu button.btn-timemanager-clear').click(function() {\n                $('#button-timemanager').click();\n            });\n\n            lizMap.events.on({\n                minidockopened: function(e) {\n                    if ( e.id == 'timemanager' ) {\n                        if (!tmActive){\n                            $('#timemanager-menu').show();\n                            activateTimemanager();\n                            tmActive = true;\n                        }\n                    }\n                },\n                minidockclosed: function(e) {\n                    if ( e.id == 'timemanager' ) {\n                        if(tmActive)\n                            deactivateTimemanager();\n                    }\n                }\n            });\n\n            // Init slider with no values\n            $(\"#tmSlider\").slider( );\n\n            var filter = null;\n            var tmAnimationTimer;\n            var tmCurrentDate;\n            var tmStartDate = -Infinity; // lower bound of when values\n            var tmEndDate = Infinity; // upper value of when values\n\n            // Size of a frame\n            var tmTimeFrameSize = config.options['tmTimeFrameSize'];\n            // Unit for the frame size : milliseconds, seconds, minutes, hours, days, weeks, months, years\n            var tmTimeFrameType = config.options['tmTimeFrameType'];\n            // Length  for each frame (between each step)\n            var tmAnimationFrameLength = config.options['tmAnimationFrameLength']\n            if (tmAnimationFrameLength < 1000)\n                tmAnimationFrameLength = 1000;\n\n            // Activate timemanager\n            function activateTimemanager(){\n\n                // hourglass\n                //$('#loading').dialog('open');\n\n                // Get min and max timestamps from layers\n                var minTime = Infinity, maxTime = -Infinity ;\n                for (l in config.timemanagerLayers) {\n                    tmLayerConfig = config.timemanagerLayers[l];\n                    getDataFromLayer(tmLayerConfig, function(mi, ma){\n\n                        // Keep min and max values\n                        config.timemanagerLayers[l]['min'] = mi;\n                        config.timemanagerLayers[l]['max'] = ma;\n\n                        // Get truncated min and max\n                        var layerMinTime = moment(mi).startOf(tmTimeFrameType.slice(0, -1))\n                        var layerMaxTime = moment(ma).endOf(tmTimeFrameType.slice(0, -1))\n\n                        // Calculate global min and max\n                        if (layerMinTime && layerMinTime < minTime) minTime = layerMinTime;\n                        if (layerMaxTime && layerMaxTime > maxTime) maxTime = layerMaxTime;\n                        tmStartDate = moment( minTime );\n                        tmEndDate = moment( maxTime );\n                        tmCurrentDate = moment( tmStartDate );\n\n                        // Set slider\n                        $('#tmCurrentValue').html(formatDatetime(tmStartDate, tmTimeFrameType));\n                        $('#tmNextValue').html(formatDatetime(tmEndDate, tmTimeFrameType));\n                        toggleNextSpan();\n                        $(\"#tmSlider\").slider({\n                            min: tmStartDate.valueOf(),\n                            max: tmEndDate.startOf(tmTimeFrameType.slice(0, -1)).valueOf(),\n                            value: tmStartDate.valueOf()\n                        });\n                        tmLayersDataFetched+= 1;\n                        tmLayersReady = (tmLayersDataFetched == tmLayersNumber);\n                        loadTimemanager(tmLayersReady);\n\n                    });\n                }\n                // Make sure to trigger filter for slider position\n                onSliderStop();\n            }\n\n            // Deactivate Timemanager feature\n            function deactivateTimemanager(){\n                // Stop animation\n                stopAnimation(true);\n\n                // Hide menu\n                $('#timemanager-menu').hide();\n                tmActive = false;\n\n                // Remove layers filters\n                unFilterTimeLayers();\n            }\n\n            function getDataFromLayer(layerConfig, aCallback){\n\n                // Get min and max timestamp from layer\n                var fieldnameContent = layerConfig.startAttribute;\n                if( layerConfig.endAttribute && layerConfig.endAttribute != ''\n                && layerConfig.endAttribute != layerConfig.startAttribute) {\n                    fieldnameContent+= ',' + layerConfig.endAttribute;\n                }\n\n                // Check if min and max are already in config\n                // Usefull for non SQL layers\n                if ('min_timestamp' in layerConfig && layerConfig.min_timestamp && layerConfig.min_timestamp != ''\n                    &&\n                    'max_timestamp' in layerConfig && layerConfig.max_timestamp && layerConfig.max_timestamp != ''\n                ) {\n                    var dmin = layerConfig.min_timestamp;\n                    var dmax = layerConfig.max_timestamp;\n                    aCallback(dmin, dmax);\n                    return true;\n                }\n\n                // Else query min and max timestamps via lizmap filter methods\n                var sdata = {\n                    request: 'getMinAndMaxValues',\n                    layerId: layerConfig.layerId,\n                    fieldname: fieldnameContent,\n                    filter: ''\n                };\n                $.get(filterConfigData.url, sdata, function(result){\n                    if( !result )\n                        return false;\n                    if( 'status' in result && result['status'] == 'error' ){\n                        console.log(result.title + ': ' + result.detail);\n                        return false;\n                    }\n                    // Get min and max from feature\n                    var dmin = null;\n                    var dmax = null;\n                    for(var a in result){\n                        var feat = result[a];\n                        dmin = feat['min'];\n                        dmax = feat['max'];\n                    }\n                    // Callback\n                    aCallback(dmin, dmax);\n\n                }, 'json');\n            }\n\n\n            // Add event on slider and buttons\n            $( \"#tmSlider\" ).on( \"slide\", function( event, ui ) {\n                onSliderUpdate();\n            });\n            $( \"#tmSlider\" ).on( \"slidestop\", function( event, ui ) {\n                onSliderStop();\n            });\n            $(\"#tmTogglePlay\").click(function(){\n                if( $(this).html() == lizDict['timemanager.toolbar.play'] ){\n                    startAnimation();\n                } else {\n                    stopAnimation();\n                }\n            });\n            $(\"#tmPrev\").click(function(){stopAnimation(false);movePrev();});\n            $(\"#tmNext\").click(function(){stopAnimation(false);moveNext();});\n\n\n            function getSideDate(curDate, timeFrameSize, timeFrameType, factor, fDirection){\n                var returnVal = moment(curDate).startOf(timeFrameType);\n                var addValue = factor * tmTimeFrameSize * fDirection;\n                returnVal.add(addValue, timeFrameType);\n                return returnVal;\n            }\n\n\n            function loadTimemanager(ready){\n                if(!ready){\n                    return true;\n                }\n                // Make sure to trigger filter for slider position\n                onSliderStop();\n            }\n\n            function startAnimation() {\n                // Stop animation if already loaded (play/pause behaviour)\n                if (tmAnimationTimer) {\n                    stopAnimation(true);\n                }\n\n                // Change play butonn into pause\n                $('#tmTogglePlay').html(lizDict['timemanager.toolbar.pause']);\n\n                // Set current date to beginning if not set\n                if (!tmCurrentDate) {\n                    tmCurrentDate = tmStartDate;\n                }\n                var next = function() {\n                    moveNext();\n                };\n                tmAnimationTimer = window.setInterval(next, tmAnimationFrameLength);\n            }\n\n\n            // Build the filter for QGIS Server\n            function buildDateFilter(layerConfig, min_val, max_val){\n                var filters = [];\n\n                // Do nothing if min and max values entered equals the field min and max possible values\n                if( min_val == layerConfig['min'] && max_val == layerConfig['max'] ){\n                    config.timemanagerLayers[l]['filter'] = null;\n                    return true;\n                }\n\n                // fields\n                var startField = layerConfig.startAttribute;\n                var endField = layerConfig.endAttribute;\n                var attributeResolution = layerConfig.attributeResolution;\n\n                // min date filter\n                if(min_val && Date.parse(min_val)){\n                    var f = '( \"' + startField + '\"' + \" >= '\" + formatDatetime(min_val, attributeResolution) + \"'\";\n                    if (endField && endField != '' && endField != startField){\n                        f+= \" OR \" + ' \"' + endField + '\"' + \" >= '\" + formatDatetime(min_val, attributeResolution) + \"'\";\n                    }\n                    f+= \" )\";\n                    filters.push(f);\n                }else{\n                    min_val = null;\n                }\n\n                // max date filter\n                if(max_val && Date.parse(max_val)){\n                    var f = '( \"' + startField + '\"' + \" <= '\" + formatDatetime(max_val, attributeResolution) + \"'\";\n                    if(endField && endField != '' && endField != startField) {\n                        f+= \" OR \" + ' \"' + endField + '\"' + \" <= '\" + formatDatetime(max_val, attributeResolution) + \"'\";\n                    }\n                    f+= \" )\";\n                    filters.push(f);\n                }else{\n                    max_val = null;\n                }\n\n                var filter = null;\n                if(filters.length){\n                    var filter = ' ( ';\n                    filter+= filters.join(' AND ');\n                    filter+= ' ) ';\n                }\n                config.timemanagerLayers[l]['data'] = {\n                    'min_date': min_val,\n                    'max_date': max_val\n                };\n                config.timemanagerLayers[l]['filter'] = filter;\n\n//console.log(filter);\n\n            }\n\n\n            function setLayersFilter(lowerBoundary, upperBoundary){\n\n                // shift upperBoundary for 1 millisecond to have strict <\n                // lowerBoundary <= attribute < upperBoundary\n                upperBoundary.subtract(1, 'milliseconds');\n\n                // Set filter for each vector layer\n                for (l in config.timemanagerLayers){\n                    buildDateFilter(config.timemanagerLayers[l], lowerBoundary, upperBoundary);\n                    filter = config.timemanagerLayers[l]['filter'];\n                    config.timemanagerLayers[l]['filter'] = filter;\n                    lizMap.triggerLayerFilter(l, filter);\n                }\n            }\n\n\n\n            function moveNext(){\n                var nextLowerBoundary = getSideDate(\n                    tmCurrentDate, tmTimeFrameSize, tmTimeFrameType, 1, 1\n                );\n\n                if (nextLowerBoundary.startOf(tmTimeFrameType.slice(0, -1)) <= tmEndDate.startOf(tmTimeFrameType.slice(0, -1))) {\n                    var lowerBoundary = null;\n                    var upperBoundary = null;\n                    // Change lower boundary\n                    lowerBoundary = nextLowerBoundary;\n                    // Change upper boundary\n                    upperBoundary = getSideDate(\n                        tmCurrentDate, tmTimeFrameSize, tmTimeFrameType, 2, 1\n                    );\n\n                    updateStep(lowerBoundary, upperBoundary);\n\n                } else {\n                    // Go back to first step\n                    stopAnimation(true);\n                    // Make sure to trigger filter for slider position\n                    onSliderStop();\n                }\n            }\n\n            function movePrev() {\n                var prevLowerBoundary = getSideDate(\n                    tmCurrentDate, tmTimeFrameSize, tmTimeFrameType, 1, -1\n                );\n                if (prevLowerBoundary.startOf(tmTimeFrameType.slice(0, -1)) >= tmStartDate.startOf(tmTimeFrameType.slice(0, -1))) {\n                    var lowerBoundary = null;\n                    var upperBoundary = null;\n                    // Change lower boundary\n                    lowerBoundary = prevLowerBoundary;\n                    // Change upper boundary\n                    upperBoundary = moment(tmCurrentDate);\n\n                    updateStep(lowerBoundary, upperBoundary);\n\n                } else {\n                    stopAnimation(true);\n                    // Make sure to trigger filter for slider position\n                    onSliderStop();\n                }\n            }\n\n            // Display/hide the span containing the next time value\n            function toggleNextSpan() {\n                var hideNextSpan = ($('#tmCurrentValue').text() == $('#tmNextValue').text());\n                $('#tmNextValue').toggle(!hideNextSpan);\n                $('#tmNextValue').prev(\"span\").toggle(!hideNextSpan);\n            }\n\n            function updateStep(lowerBoundary, upperBoundary) {\n                // Set layers filter\n                setLayersFilter(lowerBoundary, upperBoundary);\n\n                // Change global values\n                tmCurrentDate = moment(lowerBoundary);\n\n                // Display\n                $('#tmCurrentValue').html(formatDatetime(tmCurrentDate, tmTimeFrameType));\n                $('#tmNextValue').html(formatDatetime(moment(upperBoundary), tmTimeFrameType));\n                toggleNextSpan();\n                $(\"#tmSlider\").slider( \"option\", \"value\", tmCurrentDate.valueOf() );\n            }\n\n            function onSliderUpdate() {\n                var sliderVal = $(\"#tmSlider\").slider( \"option\", \"value\" );\n            }\n\n            function setSliderStep(sliderDate, type){\n                if (type == 'seconds') sliderDate = sliderDate.set( {'millisecond' : 0} );\n                if (type == 'minutes') sliderDate = sliderDate.set( {'second' : 0});\n                if (type == 'hours') sliderDate = sliderDate.set( {'minute' : 0});\n                if (type == 'days') sliderDate = sliderDate.set( {'hour' : 0});\n                if (type == 'weeks') sliderDate = sliderDate.day(1); // Monday ( TODO : make it locale aware ?)\n                if (type == 'months') sliderDate = sliderDate.set( {'day' : 1});\n                if (type == 'years') {\n                    sliderDate.set( {'month' : 0});\n                }\n                return sliderDate;\n            }\n\n            function onSliderStop() {\n                // Get slider data\n                var sliderVal = $(\"#tmSlider\").slider( \"option\", \"value\" );\n                var sliderDate = moment(sliderVal);\n\n                // Get nearest step depending on frame type (hour, year, etc.)\n                sliderDate = sliderDate.startOf(tmTimeFrameType.slice(0, -1))\n\n                // set new boundaries\n                var lowerBoundary = sliderDate;\n                var upperBoundary = getSideDate(\n                    lowerBoundary, tmTimeFrameSize, tmTimeFrameType, 1, 1\n                );\n\n                updateStep(lowerBoundary, upperBoundary);\n            }\n\n\n            function stopAnimation(reset) {\n                // Deactivate javascript timer\n                window.clearInterval(tmAnimationTimer);\n                tmAnimationTimer = null;\n\n                // Change button label to play\n                $('#tmTogglePlay').html(lizDict['timemanager.toolbar.play']);\n\n                // Reset current date to startDate if reset asked\n                if (reset === true) {\n                    tmCurrentDate = moment( tmStartDate );\n                    $('#tmCurrentValue').html(formatDatetime(tmCurrentDate, tmTimeFrameType));\n                    $(\"#tmSlider\").slider( \"option\", \"value\", tmCurrentDate.valueOf() );\n                    var upperBoundary = getSideDate(\n                        tmCurrentDate, tmTimeFrameSize, tmTimeFrameType, 1, 1\n                    );\n                    $('#tmNextValue').html(formatDatetime(upperBoundary, tmTimeFrameType));\n                    toggleNextSpan();\n                }\n            }\n\n            function unFilterTimeLayers() {\n                // Remove filter\n                for(var layerName in lizMap.config.timemanagerLayers){\n                    lizMap.deactivateMaplayerFilter(layerName);\n                    // Refresh plots and popups\n                    lizMap.config.layers[layerName]['request_params']['filtertoken'] = null;\n                    lizMap.events.triggerEvent(\"layerFilterParamChanged\",\n                        {\n                            'featureType': layerName,\n                            'filter': null,\n                            'updateDrawing': false\n                        }\n                    );\n                }\n            }\n\n            function formatDatetime(mytime, timeResolution){\n                myDate = moment(mytime);\n                var dString = null;\n                switch(timeResolution){\n                    case 'milliseconds': dString = 'YYYY-MM-DD HH:mm:ss';break;\n                    case 'seconds': dString = 'YYYY-MM-DD HH:mm:ss';break;\n                    case 'minutes': dString = 'YYYY-MM-DD HH:mm:00';break;\n                    case 'hours': dString = 'YYYY-MM-DD HH:00';break;\n                    case 'days': dString = 'YYYY-MM-DD';break;\n                    case 'weeks': dString = 'YYYY-MM-DD';break;\n                    case 'months': dString = 'YYYY-MM';break;\n                    case 'years': dString = 'YYYY';break;\n                }\n                return myDate.format(dString);\n            }\n\n        }\n    });\n\n\n}();\n"],"names":["lizMap","events","on","evt","tmLayersNumber","config","tmActive","layers","tmLayersDataFetched","Object","keys","timemanagerLayers","length","$","click","minidockopened","e","id","show","minTime","Infinity","maxTime","l","tmLayerConfig","getDataFromLayer","mi","ma","layerMinTime","moment","startOf","tmTimeFrameType","slice","layerMaxTime","endOf","tmStartDate","tmEndDate","tmCurrentDate","html","formatDatetime","toggleNextSpan","slider","min","valueOf","max","value","loadTimemanager","onSliderStop","activateTimemanager","minidockclosed","stopAnimation","hide","layerName","deactivateMaplayerFilter","triggerEvent","unFilterTimeLayers","tmAnimationTimer","filter","tmTimeFrameSize","options","tmAnimationFrameLength","layerConfig","aCallback","fieldnameContent","startAttribute","endAttribute","min_timestamp","max_timestamp","dmin","dmax","sdata","request","layerId","fieldname","get","filterConfigData","url","result","console","log","title","detail","a","feat","getSideDate","curDate","timeFrameSize","timeFrameType","factor","fDirection","returnVal","addValue","add","ready","buildDateFilter","min_val","max_val","filters","startField","endField","attributeResolution","Date","parse","f","push","join","moveNext","nextLowerBoundary","updateStep","hideNextSpan","text","toggle","prev","lowerBoundary","upperBoundary","subtract","triggerLayerFilter","setLayersFilter","sliderVal","sliderDate","reset","window","clearInterval","lizDict","mytime","timeResolution","myDate","dString","format","event","ui","this","setInterval","startAnimation","prevLowerBoundary"],"sourceRoot":""}